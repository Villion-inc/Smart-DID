{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Anchor Schema",
  "description": "Style Bible and Scene Plan for consistent video generation",
  "type": "object",
  "required": ["jobId", "title", "styleSignature", "typographyPlan", "storyboard", "safetyConstraints"],
  "properties": {
    "jobId": {
      "type": "string",
      "description": "Unique job identifier"
    },
    "title": {
      "type": "string",
      "description": "Book title"
    },
    "styleSignature": {
      "type": "object",
      "required": ["visualStyle", "colorPalette", "mood", "cameraLanguage", "genre", "consistencyHash"],
      "properties": {
        "visualStyle": {
          "type": "string",
          "enum": ["cute 3D animation", "soft 2D Ghibli style", "colorful 2D animation"]
        },
        "colorPalette": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^#[0-9A-F]{6}$"
          },
          "minItems": 4,
          "maxItems": 6
        },
        "mood": {
          "type": "string",
          "examples": ["warm, friendly, magical", "adventurous, exciting", "calm, peaceful"]
        },
        "cameraLanguage": {
          "type": "string",
          "examples": ["smooth tracking, gentle zoom", "static frames, soft transitions"]
        },
        "genre": {
          "type": "string",
          "examples": ["children's fantasy", "educational adventure", "heartwarming story"]
        },
        "consistencyHash": {
          "type": "string",
          "description": "SHA256 hash of style parameters for validation"
        }
      }
    },
    "typographyPlan": {
      "type": "object",
      "required": ["subtitleRegion", "titleRegion", "fontFamily"],
      "properties": {
        "subtitleRegion": {
          "type": "object",
          "properties": {
            "position": {
              "type": "string",
              "const": "bottom"
            },
            "safeMargin": {
              "type": "number",
              "minimum": 50,
              "maximum": 150
            },
            "maxLines": {
              "type": "number",
              "minimum": 1,
              "maximum": 2
            },
            "maxCharsPerLine": {
              "type": "number",
              "minimum": 30,
              "maximum": 50
            },
            "fontSize": {
              "type": "number",
              "minimum": 20,
              "maximum": 28
            }
          }
        },
        "titleRegion": {
          "type": "object",
          "properties": {
            "position": {
              "type": "string",
              "enum": ["center", "top"]
            },
            "displayDuration": {
              "type": "number",
              "minimum": 2,
              "maximum": 4
            },
            "fontSize": {
              "type": "number",
              "minimum": 32,
              "maximum": 48
            }
          }
        },
        "fontFamily": {
          "type": "string",
          "examples": ["Noto Sans KR", "Roboto"]
        },
        "fontWeight": {
          "type": "number",
          "enum": [400, 500, 600, 700]
        },
        "textColor": {
          "type": "string",
          "pattern": "^#[0-9A-F]{6}$"
        },
        "outlineColor": {
          "type": "string",
          "pattern": "^#[0-9A-F]{6}$"
        }
      }
    },
    "storyboard": {
      "type": "object",
      "required": ["scenes"],
      "properties": {
        "scenes": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["sceneNumber", "sceneType", "timeRange", "keyframes", "objective"],
            "properties": {
              "sceneNumber": {
                "type": "number",
                "enum": [1, 2, 3]
              },
              "sceneType": {
                "type": "string",
                "enum": ["intro", "body", "outro"]
              },
              "timeRange": {
                "type": "array",
                "items": {
                  "type": "number"
                },
                "minItems": 2,
                "maxItems": 2
              },
              "keyframes": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "timestamp": {
                      "type": "number",
                      "enum": [0, 2, 5, 8]
                    },
                    "description": {
                      "type": "string"
                    },
                    "action": {
                      "type": "string"
                    }
                  }
                }
              },
              "objective": {
                "type": "string"
              },
              "visualFocus": {
                "type": "string"
              }
            }
          },
          "minItems": 3,
          "maxItems": 3
        }
      }
    },
    "safetyConstraints": {
      "type": "object",
      "required": ["forbiddenThemes", "forbiddenWords", "requiredTone", "targetAudience"],
      "properties": {
        "forbiddenThemes": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "forbiddenWords": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "requiredTone": {
          "type": "string"
        },
        "targetAudience": {
          "type": "string"
        }
      }
    },
    "createdAt": {
      "type": "string",
      "format": "date-time"
    }
  }
}
