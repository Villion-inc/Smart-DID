# Smart DID â€” ê°œë°œ ê¸°ë¡

**ê¸°ì¤€:** `ì•„ì‚°ë„ì„œê´€_ê°œë°œ_Final.md` 84~300ë¼ì¸, `ì§„í–‰_ì²´í¬ë¦¬ìŠ¤íŠ¸.md`  
**ê·œì¹™:** ì‘ì—… 1ê°œ ì™„ë£Œ ì‹œë§ˆë‹¤ "ì™„ë£Œ ì¼ì‹œ", "ìˆ˜ì •/ì¶”ê°€ëœ íŒŒì¼", "ë‚´ìš© ìš”ì•½" ê¸°ë¡

---

## ìš”ì•½: ì§€ê¸ˆê¹Œì§€ í•œ ê²ƒ / ì•ìœ¼ë¡œ í•  ê²ƒ

### ì§€ê¸ˆê¹Œì§€ í•œ ê²ƒ

| êµ¬ë¶„ | ë‚´ìš© |
|------|------|
| **íŒŒì¼ í†µí•©** | trailer-engineì˜ pipeline, qc, retry, services(gemini-client, gemini-client-v2, veo31, nanova-banana, subtitle-generator, video-processor)ë¥¼ workerë¡œ ë³µì‚¬Â·ë³‘í•©. ìµœì¢…ì ìœ¼ë¡œ **trailer-engine ê¸°ì¤€ ê·¸ëŒ€ë¡œ ì‚¬ìš©**í•˜ë„ë¡ worker ìª½ íŒŒì¼ êµì²´ ì™„ë£Œ. |
| **ê³µìœ  íƒ€ì…** | packages/sharedì— pipeline.types.ts ë³‘í•©. workerëŠ” @smart-did/shared + worker/src/shared/types ì¬export ì‚¬ìš©. |
| **Config** | worker configì— gemini, banana, veo, outputDir, tempDir, video, subtitle, backendUrl, internalApiSecret ë“± trailer-engineÂ·lib-mvp í†µí•©. .env.example ë³´ê°•. |
| **Backend ì½œë°±** | `POST /api/internal/video-callback` ì¶”ê°€. Worker ì™„ë£Œ/ì‹¤íŒ¨ ì‹œ bookId, status, videoUrl, subtitleUrl, errorMessageë¡œ DB ê°±ì‹ . |
| **Worker ì½œë°±** | worker.tsì—ì„œ Pipeline V2 ì‹¤í–‰ í›„ ì„±ê³µ/ì‹¤íŒ¨ ì‹œ notifyBackendVideoCallback í˜¸ì¶œ. (ì‘ì—… 13ì—ì„œ ì§„ì…ì ì„ V2ë¡œ ì „í™˜ ì™„ë£Œ) |
| **ì €ì¥ì†Œ ì¶”ìƒí™”** | StorageProvider ì¸í„°í˜ì´ìŠ¤, LocalStorageProvider, S3StorageProvider(ìŠ¤í…), getStorageProvider() factory. |
| **ì•ˆì „ ê²€ì¦** | prompt.service.validateSafetyë¥¼ QC safetyKeywords ê¸°ë°˜ isTextSafeForChildren ì‚¬ìš©ìœ¼ë¡œ í†µì¼. |
| **GeminiProvider** | GeminiProviderAdapter êµ¬í˜„. í‚¤í”„ë ˆì„=NanovaBananaClient(Banana.dev) ë˜ëŠ” í”Œë ˆì´ìŠ¤í™€ë”, ë¹„ë””ì˜¤=Veo31Client(imageBuffer base64 ì—°ë™). |
| **í…ŒìŠ¤íŠ¸ ê¸°ë™ ì˜¤ë¥˜ ìˆ˜ì •** | Prisma 5 ì „ìš© ìŠ¤í¬ë¦½íŠ¸, Workerìš© shared ë¹Œë“œ ì„ í–‰, Backend FastifyÂ·@fastify/jwt ë²„ì „ í˜¸í™˜, í…ŒìŠ¤íŠ¸ ì¤€ë¹„ ë¬¸ì„œÂ·Frontend type:module ì¶”ê°€. `npm run dev`ë¡œ BackendÂ·FrontendÂ·Worker ì •ìƒ ê¸°ë™ í™•ì¸. |
| **Worker ì§„ì…ì  Pipeline V2 ì „í™˜** | worker.tsì—ì„œ videoGeneratorService ì œê±°, PipelineOrchestratorV2 + GeminiProviderAdapter í˜¸ì¶œë¡œ êµì²´. Job â†’ VideoGenerationRequest ë§¤í•‘, ê²°ê³¼(completed/failed)ë¥¼ ê¸°ì¡´ Backend ì½œë°±(READY/FAILED)ìœ¼ë¡œ ì „ë‹¬. |
| **í”„ë¡ íŠ¸ì—”ë“œ DID ì˜ìƒ ì¬ìƒÂ·í”„ë¡œí† íƒ€ì…** | DidVideoPlayer ì˜ìƒ URL ìˆ˜ì •(/api í¬í•¨), /pip ë¼ìš°íŠ¸ ì¶”ê°€, í”„ë¡œí† íƒ€ì… fallback ìƒ˜í”Œ ì˜ìƒ, vite-env.d.ts íƒ€ì… ë³´ê°•. |
| **ë°±ì—”ë“œ ê¸°ë™ ì˜¤ë¥˜ ìˆ˜ì •** | dev ìŠ¤í¬ë¦½íŠ¸ tsx watch â†’ tsx ë³€ê²½(EPERM ë°©ì§€), @fastify/corsÂ·helmetÂ·swaggerÂ·swagger-uië¥¼ Fastify 5 í˜¸í™˜ ë²„ì „ìœ¼ë¡œ ì—…ê·¸ë ˆì´ë“œ. |
| **Worker .env ë¡œë“œ ê²½ë¡œ ìˆ˜ì •** | configì—ì„œ .env ê²½ë¡œë¥¼ library-did-main/.envë¥¼ ì°¾ë„ë¡ ë‹¤ì¤‘ ê²½ë¡œ ì‹œë„, ê¸°ë™ ì‹œ GEMINI/OPENAI/VEO í‚¤ ë¡œë“œ ì—¬ë¶€ ë¡œê·¸ ì¶”ê°€. |
| **MVP Mock ë„ì„œ ì „í™˜** | alpas.service â†’ Mock ì‚¬ìš©. DIDÂ·ì˜ìƒ ìš”ì²­ì´ BK001~BK035(35ê¶Œ) ê¸°ì¤€ìœ¼ë¡œ ë™ì‘. /pip ê¸°ë³¸ BK001. |
| **Sora APIÂ·ì½œë°± 401** | Sora ì—”ë“œí¬ì¸íŠ¸ë¥¼ ê³µì‹ ìŠ¤í™(POST/GET /v1/videos)ìœ¼ë¡œ ìˆ˜ì •. ì½œë°± 401 ì‹œ INTERNAL_API_SECRET ì¼ì¹˜ ì•ˆë‚´. |
| **3ì¥ë©´ FFmpeg ë³‘í•©** | trailer-engineì˜ VideoAssembler ì‚¬ìš©. Pipeline V2 Step 7ì—ì„œ ì„±ê³µí•œ ì¥ë©´ì„ temp íŒŒì¼ë¡œ ì“´ ë’¤ concat+ìë§‰ burn â†’ storage ì €ì¥. FFmpeg ì—†ìœ¼ë©´ ì²« ì¥ë©´ë§Œ ì €ì¥ fallback. |
| **Admin 480pxÂ·DID ë ˆì´ì•„ì›ƒ** | Adminì„ DIDì™€ ë™ì¼ 480px ë·°í¬íŠ¸ë¡œ í†µì¼. AdminLayout, ëŒ€ì‹œë³´ë“œ(API í˜„í™©Â·ì‚¬ì„œ ì¶”ì²œÂ·ì¸ê¸° ì±…Â·ì´ìš©ì ë¡œê·¸), ì¶”ì²œë„ì„œ ë“±ë¡(/admin/recommend), ì˜ìƒ ê´€ë¦¬ ì¹´ë“œ ë¦¬ìŠ¤íŠ¸. "ì´ ì±…ì€ ì—¬ê¸° ìˆì–´ìš”!"ëŠ” ìœ„ì¹˜ ì•ˆë‚´ í˜ì´ì§€ë§Œ ë…¸ì¶œ. /did ë‚´ í˜ì´ì§€ ì´ë™ ì‹œ ìŠ¤í¬ë¡¤ë°”Â·ê°€ë¡œ ìŠ¤í¬ë¡¤ë¡œ ì¸í•œ í”ë“¤ë¦¼ ë°©ì§€(scrollbar-gutter: stable, overflow-x hidden). |

### ì•ìœ¼ë¡œ í•  ê²ƒ

| ìš°ì„ ìˆœìœ„ | í•­ëª© | ì„¤ëª… |
|----------|------|------|
| **1** | FFmpeg ê²€ì¦Â·í°íŠ¸ | Pipeline V2ì—ì„œ 3ì¥ë©´ ë³‘í•©Â·ìë§‰ burn ì—°ë™ ì™„ë£Œ. FFmpeg ì„¤ì¹˜ ì‹œ ë™ì‘. ìë§‰ í°íŠ¸(Noto Sans KR) ë¯¸ì„¤ì¹˜ ì‹œ addSubtitles ì‹¤íŒ¨ ê°€ëŠ¥. |
| **2** | í”„ë¡œë•ì…˜ DB | Prisma ìŠ¤í‚¤ë§ˆ ì´ë¯¸ ìˆìŒ. PostgreSQL ì „í™˜ ì‹œ DATABASE_URL ë³€ê²½, ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰. subtitleUrl ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš© í™•ì¸. |
| **3** | S3 ìŠ¤í† ë¦¬ì§€ ì‹¤ì œ êµ¬í˜„ | S3StorageProvider ìŠ¤í…ì„ AWS SDK ì—°ë™ìœ¼ë¡œ êµì²´. presigned URL ìƒì„±. |
| **4** | ALPAS ì‹¤ì œ API | AD201(ê²€ìƒ‰), AD206(ìƒì„¸), AE117(ì‹ ì°©) ìŠ¤ì¼ˆë ˆí†¤ ì™„ì„±. |
| **5** | íƒ€ì… í†µí•© ì •ë¦¬ | shared íƒ€ì…ê³¼ worker/shared ì¬export ì •ë¦¬. í•„ìš” ì‹œ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë¶„ë¦¬. |
| **ì„ íƒ** | Config DI | ì‹±ê¸€í†¤ â†’ DI íŒ¨í„´ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ìš©ì´í™”. |
| **ì„ íƒ** | WebSocket ì§„í–‰ë¥ , BullMQ Dashboard, E2E í…ŒìŠ¤íŠ¸ ë“± | 4.2Â·4.3ì ˆ í•­ëª©. |

---

## í…ŒìŠ¤íŠ¸ìš© í™˜ê²½ë³€ìˆ˜

ì§€ê¸ˆê¹Œì§€ ì‘ì—…í•œ Backend + Worker + ì½œë°±Â·ì•ˆì „ê²€ì¦Â·GeminiProvider ë“±ì„ ë¡œì»¬ì—ì„œ ëŒë¦¬ê¸° ìœ„í•´ í•„ìš”í•œ í™˜ê²½ë³€ìˆ˜ì…ë‹ˆë‹¤.  
**ìœ„ì¹˜:** `library-did-main/.env` (ë£¨íŠ¸ì— í•˜ë‚˜ ë‘ë©´ backend/workerê°€ ê³µí†µìœ¼ë¡œ ì°¸ì¡°)

### í•„ìˆ˜ (ë™ì‘ì— ë°˜ë“œì‹œ í•„ìš”)

| ë³€ìˆ˜ëª… | ìš©ë„ | ì˜ˆì‹œ |
|--------|------|------|
| `DATABASE_URL` | Backend Prisma DB | `file:./packages/backend/prisma/dev.db` (SQLite) |
| `JWT_SECRET` | Backend ë¡œê·¸ì¸Â·ì¸ì¦ | 32ì ì´ìƒ ë¬¸ìì—´ |
| `INTERNAL_API_SECRET` | Worker â†’ Backend ì½œë°± ì¸ì¦ (ì—†ìœ¼ë©´ JWT_SECRET ì‚¬ìš©) | **Backendì™€ Workerê°€ ë™ì¼í•œ ê°’ì´ì–´ì•¼ í•¨.** ë¶ˆì¼ì¹˜ ì‹œ ì½œë°± 401 Unauthorized |
| `REDIS_HOST` | BullMQ í | `localhost` |
| `REDIS_PORT` | Redis í¬íŠ¸ | `6379` |
| `GEMINI_API_KEY` | Worker(GeminiClient ë“±) â€” **ì—†ìœ¼ë©´ Worker ê¸°ë™ ì‹œ ì—ëŸ¬** | Google AI Studioì—ì„œ ë°œê¸‰ |
| `BACKEND_URL` | Workerê°€ ì½œë°± í˜¸ì¶œí•  Backend ì£¼ì†Œ | `http://localhost:3000` |

### ì„ íƒ (ê¸°ëŠ¥ë³„)

| ë³€ìˆ˜ëª… | ìš©ë„ | ë¹„ê³  |
|--------|------|------|
| `BANANA_API_KEY`, `BANANA_MODEL_KEY` | Pipeline V2 í‚¤í”„ë ˆì„ ì‹¤ì œ ì´ë¯¸ì§€ (Banana.dev) | ì—†ìœ¼ë©´ í‚¤í”„ë ˆì„ì€ í”Œë ˆì´ìŠ¤í™€ë” PNG |
| `VEO_API_KEY` | Pipeline V2 ì‹¤ì œ ë¹„ë””ì˜¤ ìƒì„± (Veo 3.1) | ì—†ìœ¼ë©´ V2 ë¹„ë””ì˜¤ ë‹¨ê³„ì—ì„œ ì—ëŸ¬ (í˜„ì¬ ì§„ì…ì ì€ ê¸°ì¡´ í”Œë¡œìš°) |
| `VEO_PROJECT_ID`, `VEO_LOCATION` | Veo Vertex AI í”„ë¡œì íŠ¸/ë¦¬ì „ | ê¸°ë³¸ê°’: your-project-id, us-central1 |
| `PORT` | Backend í¬íŠ¸ | ê¸°ë³¸ 3000 |
| `STORAGE_TYPE`, `STORAGE_PATH` | ì˜ìƒ ì €ì¥ ìœ„ì¹˜ | ê¸°ë³¸ local, `./storage/videos` |
| `WORKER_CONCURRENCY` | ë™ì‹œ Job ìˆ˜ | ê¸°ë³¸ 2 |

### ìµœì†Œ .env ì˜ˆì‹œ (ë³µì‚¬í•´ì„œ ì‚¬ìš©)

```env
# í•„ìˆ˜
DATABASE_URL=file:./packages/backend/prisma/dev.db
JWT_SECRET=your-secret-key-change-in-production-32chars
INTERNAL_API_SECRET=your-secret-key-change-in-production-32chars
REDIS_HOST=localhost
REDIS_PORT=6379
GEMINI_API_KEY=ì—¬ê¸°ì—_ì‹¤ì œ_í‚¤
BACKEND_URL=http://localhost:3000

# ì„ íƒ (ê¸°ë³¸ê°’ìœ¼ë¡œ ë™ì‘)
PORT=3000
NODE_ENV=development
LOG_LEVEL=info
STORAGE_TYPE=local
STORAGE_PATH=./storage/videos
WORKER_CONCURRENCY=2
```

### í˜„ì¬ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥ ë²”ìœ„ (npm run dev ê¸°ì¤€)

ì§€ê¸ˆ ë¡œì»¬ì—ì„œ `npm run dev`ë¡œ ëŒë ¸ì„ ë•Œ **ì–´ë””ê¹Œì§€ ì‹¤ì œë¡œ ë™ì‘í•˜ëŠ”ì§€** ì •ë¦¬í•œ ë‚´ìš©ì…ë‹ˆë‹¤.

| êµ¬ë¶„ | êµ¬í˜„ ì—¬ë¶€ | ë¹„ê³  |
|------|------------|------|
| **Frontend** | âœ… ë™ì‘ | ë¡œê·¸ì¸, ë„ì„œ ê²€ìƒ‰, ìƒì„¸, ì˜ìƒ ìƒì„± ìš”ì²­, ìƒíƒœ í‘œì‹œ. Backend API ì—°ë™. |
| **Backend API** | âœ… ë™ì‘ | ì¸ì¦, ë„ì„œ ê²€ìƒ‰/ìƒì„¸, ì˜ìƒ ìš”ì²­(í ë“±ë¡), DB(Prisma/SQLite), Swagger ë¬¸ì„œ. |
| **ì˜ìƒ ìš”ì²­ â†’ í ë“±ë¡** | âœ… ë™ì‘ | ìš”ì²­ ì‹œ ìƒíƒœ `QUEUED`ë¡œ ì €ì¥, BullMQì— Job ì¶”ê°€. |
| **Worker Job ì²˜ë¦¬** | âœ… ë™ì‘ | Job ìˆ˜ì‹  â†’ Pipeline V2(Book Grounding, Style Bible, ì¥ë©´ ê³„íšÂ·ìŠ¤í¬ë¦½íŠ¸, í‚¤í”„ë ˆì„, Sora/Veo ì˜ìƒ, ìë§‰, **3ì¥ë©´ FFmpeg ë³‘í•©** â†’ storage ì €ì¥). |
| **Worker â†’ Backend ì½œë°±** | âœ… ë™ì‘ | ì™„ë£Œ ì‹œ `READY` + videoUrl/subtitleUrl, ì‹¤íŒ¨ ì‹œ `FAILED` + errorMessage ë¡œ DB ê°±ì‹ . |
| **ìƒíƒœ íë¦„** | âš ï¸ ë¶€ë¶„ | `QUEUED` â†’ (Worker ì™„ë£Œ ì‹œ) `READY` ë˜ëŠ” `FAILED`. **GENERATING**ìœ¼ë¡œ ë°”ê¾¸ëŠ” â€œì‘ì—… ì‹œì‘â€ ì½œë°±ì€ ë¯¸êµ¬í˜„. |
| **ì‹¤ì œ ì˜ìƒ ìƒì„±** | âœ… Sora/Veo | OPENAI_API_KEY(Sora) ë˜ëŠ” VEO_API_KEY ì„¤ì • ì‹œ ì‹¤ì œ ì˜ìƒ ìƒì„±. í‚¤í”„ë ˆì„ì€ BANANA ë˜ëŠ” í”Œë ˆì´ìŠ¤í™€ë”. |
| **Pipeline V2** | âœ… ì—°ë™ | Worker ì§„ì…ì ì€ PipelineOrchestratorV2. 3ì¥ë©´ ìƒì„± í›„ VideoAssembler.concatAndSubtitlesë¡œ ë³‘í•©Â·ìë§‰ burn í›„ ì €ì¥. |
| **ì €ì¥** | âœ… ë¡œì»¬ | `STORAGE_TYPE=local` ê¸°ì¤€ ë³‘í•©ëœ MP4ë¥¼ `STORAGE_PATH`ì— ì €ì¥. FFmpeg ì—†ìœ¼ë©´ ì²« ì¥ë©´ë§Œ ì €ì¥(fallback). S3ëŠ” ìŠ¤í…. |

**ì •ë¦¬:**  
- **E2E:** ì˜ìƒ ìƒì„± ìš”ì²­ â†’ í â†’ Worker Pipeline V2 â†’ Sora/Veo ì˜ìƒ ìƒì„± â†’ FFmpeg 3ì¥ë©´ ë³‘í•©Â·ìë§‰ â†’ storage ì €ì¥ â†’ ì½œë°± â†’ í”„ë¡ íŠ¸ ìƒíƒœÂ·ì¬ìƒ.  
- **í•„ìˆ˜:** Redis, FFmpeg(ë³‘í•©ìš©), GEMINI_API_KEY, OPENAI_API_KEY ë˜ëŠ” VEO_API_KEY.

---

### í…ŒìŠ¤íŠ¸ ì „ ì¤€ë¹„

1. **Redis ì‹¤í–‰**  
   `redis-server` ë˜ëŠ” Docker: `docker run -d -p 6379:6379 redis`

2. **DB ë§ˆì´ê·¸ë ˆì´ì…˜**  
   `library-did-main` ë£¨íŠ¸ì—ì„œ:
   ```bash
   cd packages/backend && npx prisma migrate deploy
   # ë˜ëŠ” ìŠ¤í‚¤ë§ˆë§Œ ë°˜ì˜: npx prisma db push
   npx prisma generate
   ```

3. **ì˜ì¡´ì„±**  
   workerì—ì„œ: `npm install @google/generative-ai axios fluent-ffmpeg`  
   (ì´ë¯¸ package.jsonì— ìˆìœ¼ë©´ ìƒëµ)

4. **ì‹¤í–‰ ìˆœì„œ**  
   Backend â†’ Worker ìˆœìœ¼ë¡œ ê¸°ë™. FrontendëŠ” `REACT_APP_API_URL=http://localhost:3000/api` ë¡œ Backend ì§€ì •.

---

## ì™„ë£Œëœ ì‘ì—… (ìƒì„¸)

### ì‘ì—… 1 â€” pipeline í´ë” ë³µì‚¬ (ì²´í¬ë¦¬ìŠ¤íŠ¸ 2ë²ˆ #1)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-09 |
| **ìˆ˜ì •ëœ íŒŒì¼** | ì—†ìŒ |
| **ì¶”ê°€ëœ íŒŒì¼** | `library-did-main/packages/worker/src/pipeline/` í•˜ìœ„ ì „ì²´ |
| **ì¶”ê°€ ê²½ë¡œ** | `pipeline/assemble.ts`, `pipeline/orchestrator.ts`, `pipeline/planning/index.ts`, `pipeline/planning/scenePlanner.ts`, `pipeline/style/styleBible.ts`, `pipeline/grounding/index.ts`, `pipeline/grounding/buildBookFacts.ts`, `pipeline/grounding/fetchCandidates.ts`, `pipeline/grounding/rankCandidates.ts` |
| **ë‚´ìš© ìš”ì•½** | trailer-engine `src/pipeline/` í´ë”ë¥¼ lib-mvp Workerë¡œ í†µì§¸ë¡œ ë³µì‚¬í•¨. Book Grounding, Style Bible, Scene Planning, V2 ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„° ë“± íŒŒì´í”„ë¼ì¸ ì½”ë“œê°€ worker ë‚´ë¶€ì— ìœ„ì¹˜í•¨. |
| **ë¹„ê³ ** | ë³µì‚¬ë³¸ì€ ê¸°ì¡´ trailer-engine ìƒëŒ€ ê²½ë¡œ(`../shared/types`, `../config`, `../worker/`, `../qc/`, `../anchor/`, `../cost/`, `../subtitles/`, `../cache/`)ë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ë¯€ë¡œ, ì•„ì§ ë¹Œë“œ ë¶ˆê°€. ë‹¤ìŒ ì‘ì—…ì—ì„œ qcÂ·retryÂ·servicesÂ·íƒ€ì…Â·config ë³µì‚¬Â·ë³‘í•© í›„ import ê²½ë¡œ ì •ë¦¬ ì˜ˆì •. |

---

### ì‘ì—… 2 â€” gemini-* ì„œë¹„ìŠ¤ ë³µì‚¬ + import ì •ë¦¬ (ì²´í¬ë¦¬ìŠ¤íŠ¸ 2ë²ˆ #2)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-09 |
| **ìˆ˜ì •ëœ íŒŒì¼** | `packages/worker/src/config/index.ts` â€” `geminiApiKey`, `gemini.model/temperature/maxRetries` ì¶”ê°€ |
| **ì¶”ê°€ëœ íŒŒì¼** | `packages/worker/src/services/gemini-client.ts`, `packages/worker/src/services/gemini-client-v2.ts`, `packages/worker/src/types/index.ts` |
| **ë‚´ìš© ìš”ì•½** | trailer-engineì˜ `gemini-client.ts`, `gemini-client-v2.ts`ë¥¼ worker/servicesë¡œ ë³µì‚¬. Workerì—ì„œ `../types`ê°€ ì°¸ì¡° ê°€ëŠ¥í•˜ë„ë¡ `worker/src/types/index.ts`ì— Scene, ScenePromptPayload, GeminiVideoResponse íƒ€ì… ì¶”ê°€. Configì— GEMINI ê´€ë ¨ í•„ë“œ ì¶”ê°€í•˜ì—¬ Gemini í´ë¼ì´ì–¸íŠ¸ ìƒì„±ì ë™ì‘ ê°€ëŠ¥í•˜ë„ë¡ í•¨. |
| **ë¹„ê³ ** | gemini-*ëŠ” `../config`, `../types` ì‚¬ìš© ì¤‘. íƒ€ì…ì€ ì¶”í›„ shared íŒ¨í‚¤ì§€ ë³‘í•© ì‹œ ì´ì „ ì˜ˆì •. workerì—ì„œ `npm install @google/generative-ai` ì‹¤í–‰ í•„ìš”. |

---

### ì‘ì—… 3 â€” sora-client ìŠ¤í‚µ + veo31 / video-processor / subtitle-generator ë³µì‚¬ (ì²´í¬ë¦¬ìŠ¤íŠ¸ 2ë²ˆ #3~#6)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-09 |
| **ìˆ˜ì •ëœ íŒŒì¼** | `packages/worker/src/types/index.ts` â€” `SubtitleEntry` íƒ€ì… ì¶”ê°€ |
| **ì¶”ê°€ëœ íŒŒì¼** | `packages/worker/src/services/veo31-client.ts`, `packages/worker/src/services/video-processor.ts`, `packages/worker/src/services/subtitle-generator.ts` |
| **ë‚´ìš© ìš”ì•½** | **#3** trailer-engineì— `sora-client.ts` ì—†ìŒ â†’ ìŠ¤í‚µ. **#4** `veo31-client.ts` ë³µì‚¬ (Veo 3.1 Image-to-Video í´ë¼ì´ì–¸íŠ¸). **#5** `video-processor.ts` ë³µì‚¬ (FFmpeg ë³‘í•©Â·ìë§‰Â·ë”ë¯¸ ë¹„ë””ì˜¤). **#6** `subtitle-generator.ts` ë³µì‚¬ (WebVTT/SRT ìë§‰ ìƒì„±). video-processorÂ·subtitle-generatorìš©ìœ¼ë¡œ typesì— `SubtitleEntry` ì¶”ê°€. |
| **ë¹„ê³ ** | ê¸°ì¡´ `veo.service.ts`ëŠ” ìœ ì§€(ì§„ì…ì  ì—°ë™ ì‹œ êµì²´ ì˜ˆì •). workerì—ì„œ `npm install fluent-ffmpeg` ë° `npm install -D @types/fluent-ffmpeg` ì‹¤í–‰ í•„ìš”. |

---

### ì‘ì—… 4 â€” qc í´ë” ë³µì‚¬ (ì²´í¬ë¦¬ìŠ¤íŠ¸ 2ë²ˆ #7)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-09 |
| **ìˆ˜ì •ëœ íŒŒì¼** | ì—†ìŒ |
| **ì¶”ê°€ëœ íŒŒì¼** | `packages/worker/src/qc/` í•˜ìœ„ ì „ì²´ |
| **ì¶”ê°€ ê²½ë¡œ** | `qc/qcRunner.ts`, `qc/safetyGate.ts`, `qc/checkTypography.ts`, `qc/checkConsistency.ts`, `qc/scoreVideo.ts`, `qc/safetyKeywords.json`, `qc/thresholds.json`, `qc/typographyRules.json` |
| **ë‚´ìš© ìš”ì•½** | trailer-engine `src/qc/` í´ë”ë¥¼ workerë¡œ í†µì§¸ë¡œ ë³µì‚¬. Safety Gate â†’ Typography â†’ Consistency â†’ Video Scoring ìˆœì„œì˜ QC íŒŒì´í”„ë¼ì¸ ì½”ë“œ. |
| **ë¹„ê³ ** | qc ëª¨ë“ˆì€ `../shared/types`(QCReport, SceneScript, Anchor, TypographyPlan ë“±) ì°¸ì¡°. íƒ€ì… í†µí•©(shared ë³‘í•©) í›„ import ê²½ë¡œ ì •ë¦¬ ì˜ˆì •. **sora-client.ts**: trailer-engineÂ·lib-mvp ë‘˜ ë‹¤ í•´ë‹¹ íŒŒì¼ ì—†ìŒ(ë¬¸ì„œë§Œ ì–¸ê¸‰). |

---

### ì‘ì—… 5 â€” retry í´ë” ë³µì‚¬ (ì²´í¬ë¦¬ìŠ¤íŠ¸ 2ë²ˆ #8, #9)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-09 |
| **ìˆ˜ì •ëœ íŒŒì¼** | ì—†ìŒ |
| **ì¶”ê°€ëœ íŒŒì¼** | `packages/worker/src/retry/hierarchicalRetry.ts`, `retry/retryPolicy.ts`, `retry/sceneGenerator.ts` |
| **ë‚´ìš© ìš”ì•½** | trailer-engine `src/worker/`ì˜ hierarchicalRetry, retryPolicy, sceneGeneratorë¥¼ worker `src/retry/`ë¡œ ë³µì‚¬. ê³„ì¸µì  ì¬ì‹œë„(Scriptâ†’Keyframeâ†’Video), ì¥ë©´ë³„ ì¬ì‹œë„ ì •ì±…, ë³‘ë ¬/ìˆœì°¨ ì¥ë©´ ìƒì„± ë¡œì§. |
| **ë¹„ê³ ** | `../shared/types`, `../qc/thresholds.json` ì°¸ì¡°. qcëŠ” ì´ë¯¸ ë³µì‚¬ë¨ìœ¼ë¡œ thresholds.json ê²½ë¡œëŠ” ìœ íš¨. shared íƒ€ì…ì€ í†µí•© í›„ ì •ë¦¬. |

---

### ì‘ì—… 6 â€” Backend ë‚´ë¶€ ì½œë°± API ì¶”ê°€ (ì²´í¬ë¦¬ìŠ¤íŠ¸ 1Â·3.3 A ì—°ë™)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-09 |
| **ìˆ˜ì •ëœ íŒŒì¼** | `packages/backend/src/config/index.ts` â€” `internalApiSecret` ì¶”ê°€, `packages/backend/src/index.ts` â€” internal ë¼ìš°íŠ¸ ë“±ë¡, `packages/backend/prisma/schema.prisma` â€” `subtitleUrl` ì»¬ëŸ¼ ì¶”ê°€ |
| **ì¶”ê°€ëœ íŒŒì¼** | `packages/backend/src/routes/internal.routes.ts`, `packages/backend/prisma/migrations/20260209000000_add_subtitle_url/migration.sql` |
| **ë‚´ìš© ìš”ì•½** | Workerê°€ ì˜ìƒ ìƒì„± ì™„ë£Œ/ì‹¤íŒ¨ ì‹œ Backend DBë¥¼ ê°±ì‹ í•  ìˆ˜ ìˆë„ë¡ `POST /api/internal/video-callback` ì¶”ê°€. Body: bookId, status(READY\|FAILED), videoUrl?, subtitleUrl?, errorMessage?. Header: X-Internal-Secret. VideoRecordì— subtitleUrl ì»¬ëŸ¼ ì¶”ê°€(ë§ˆì´ê·¸ë ˆì´ì…˜). |
| **ë¹„ê³ ** | ì›ê²© DB ë§ˆì´ê·¸ë ˆì´ì…˜ì€ ì—°ê²° ì´ìŠˆë¡œ ë¯¸ì ìš©. ë¡œì»¬ì—ì„œ `npx prisma migrate deploy` ë˜ëŠ” `prisma db push` ì‹¤í–‰ í•„ìš”. |

---

### ì‘ì—… 7 â€” Worker ì§„ì…ì  ì½œë°± ì—°ë™ (ì²´í¬ë¦¬ìŠ¤íŠ¸ 1Â·3.3 A)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-09 |
| **ìˆ˜ì •ëœ íŒŒì¼** | `packages/worker/src/config/index.ts` â€” backendUrl, internalApiSecret ì¶”ê°€. `packages/worker/src/worker.ts` â€” ì™„ë£Œ/ì‹¤íŒ¨ ì‹œ notifyBackendVideoCallback í˜¸ì¶œ |
| **ì¶”ê°€ëœ íŒŒì¼** | `packages/worker/src/services/backend-callback.service.ts` |
| **ë‚´ìš© ìš”ì•½** | Worker Job ì²˜ë¦¬ í›„ ì„±ê³µ ì‹œ READY + videoUrl/subtitleUrl, ì‹¤íŒ¨ ì‹œ FAILED + errorMessageë¡œ Backend ì½œë°± í˜¸ì¶œ. ì§„ì…ì ì€ ë‹¹ë¶„ê°„ ê¸°ì¡´ videoGeneratorService.generateVideo() ìœ ì§€(íŒŒì´í”„ë¼ì¸ V2 ì „í™˜ ì‹œ GeminiProvider êµ¬í˜„ í›„ êµì²´ ì˜ˆì •). |
| **ë¹„ê³ ** | í™˜ê²½ë³€ìˆ˜: BACKEND_URL, INTERNAL_API_SECRET(ë˜ëŠ” JWT_SECRET). |

---

### ì‘ì—… 8 â€” ì €ì¥ì†Œ ì¶”ìƒí™” (ì²´í¬ë¦¬ìŠ¤íŠ¸ 3.3 D)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-09 |
| **ìˆ˜ì •ëœ íŒŒì¼** | ì—†ìŒ |
| **ì¶”ê°€ëœ íŒŒì¼** | `packages/worker/src/services/storage.provider.ts`, `storage-local.provider.ts`, `storage-s3.provider.ts`, `storage-provider.factory.ts` |
| **ë‚´ìš© ìš”ì•½** | StorageProvider ì¸í„°í˜ì´ìŠ¤(save/load/exists/getUrl) ì •ì˜. LocalStorageProvider(ë¡œì»¬ ë””ìŠ¤í¬), S3StorageProvider(ìŠ¤í…) êµ¬í˜„. getStorageProvider()ë¡œ config.storage.typeì— ë”°ë¼ local/s3 ë°˜í™˜. ê¸°ì¡´ storage.service.tsëŠ” ìœ ì§€. |
| **ë¹„ê³ ** | S3 ì‹¤ì œ ì—°ë™ì€ ì¶”í›„ êµ¬í˜„. STORAGE_TYPE=local ê¸°ë³¸. |

---

### ì‘ì—… 9 â€” .env.example ë³´ê°• + Config í†µí•© (ì²´í¬ë¦¬ìŠ¤íŠ¸ 3.3 B, 7ì¥)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-09 |
| **ìˆ˜ì •ëœ íŒŒì¼** | `library-did-main/.env.example`, `packages/worker/src/config/index.ts` â€” openaiApiKey ì¶”ê°€ |
| **ì¶”ê°€ëœ íŒŒì¼** | ì—†ìŒ |
| **ë‚´ìš© ìš”ì•½** | .env.exampleì— GEMINI_*, BACKEND_URL, INTERNAL_API_SECRET, OUTPUT_DIR, TEMP_DIR, SUBTITLE_LANGUAGE, LOG_LEVEL, DATABASE_URL, S3 ê´€ë ¨ ë“± ë°˜ì˜. Worker configì— OPENAI_API_KEY ì¶”ê°€. |
| **ë¹„ê³ ** | ì²´í¬ë¦¬ìŠ¤íŠ¸ 7ì¥ í™˜ê²½ë³€ìˆ˜ í‘œì™€ ë™ì¼í•˜ê²Œ ì •ë¦¬. |

---

### ì‘ì—… 10 â€” QC safetyGate ì—°ë™ (ì²´í¬ë¦¬ìŠ¤íŠ¸ 4ì ˆ Critical #4)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-09 |
| **ìˆ˜ì •ëœ íŒŒì¼** | `packages/worker/src/services/prompt.service.ts` â€” validateSafetyì—ì„œ isTextSafeForChildren ì‚¬ìš© |
| **ì¶”ê°€ëœ íŒŒì¼** | `packages/worker/src/qc/safetyCheck.ts` |
| **ë‚´ìš© ìš”ì•½** | ì½˜í…ì¸  ì•ˆì „ ê²€ì¦ì„ sharedì˜ isContentSafe ëŒ€ì‹  QC safetyGateì™€ ë™ì¼í•œ safetyKeywords.json ê¸°ë°˜ ê²€ì‚¬ë¡œ í†µì¼. safetyCheck.isTextSafeForChildren(title/summary)ë¡œ ê¸ˆì§€ ë‹¨ì–´Â·í…Œë§ˆ ê²€ì‚¬ í›„ VideoGeneratorServiceì—ì„œ ì‚¬ìš©. |
| **ë¹„ê³ ** | íŒŒì´í”„ë¼ì¸ V2 ì§„ì… ì‹œ ìŠ¤í¬ë¦½íŠ¸ ë‹¨ê³„ì—ì„œëŠ” ê¸°ì¡´ SafetyGate.validate(scripts, constraints) ìœ ì§€. |

---

### ì‘ì—… 11 â€” GeminiProvider êµ¬í˜„ + trailer-engine ì„œë¹„ìŠ¤ ê·¸ëŒ€ë¡œ ì‚¬ìš© (2.2ì ˆ ê¸°ì¤€)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-09 |
| **ìˆ˜ì •ëœ íŒŒì¼** | `packages/worker/src/services/gemini-client.ts`, `gemini-client-v2.ts`, `veo31-client.ts`, `nanova-banana-client.ts`, `subtitle-generator.ts`, `video-processor.ts`, `config/index.ts`(banana ì¶”ê°€) |
| **ì¶”ê°€ëœ íŒŒì¼** | `packages/worker/src/services/gemini-provider.adapter.ts` |
| **ë‚´ìš© ìš”ì•½** | **GeminiProvider:** PipelineOrchestratorV2ìš© GeminiProviderAdapter êµ¬í˜„. generateKeyframe = BANANA ì„¤ì • ì‹œ NanovaBananaClient(ì´ë¯¸ì§€ ìƒì„± í›„ Buffer ë°˜í™˜), ë¯¸ì„¤ì • ì‹œ í”Œë ˆì´ìŠ¤í™€ë” PNG. generateVideo = Veo31Client.generateVideoFromImageBuffer(keyframeBuffer, prompt, duration). **ì„œë¹„ìŠ¤ íŒŒì¼:** ì•„ì‚°ë„ì„œê´€_ê°œë°œ_Final.md 2.2ì ˆ â€œê·¸ëŒ€ë¡œ ì‚¬ìš©â€ ê¸°ì¤€ìœ¼ë¡œ, gemini-client, gemini-client-v2, veo31-client, nanova-banana-client, subtitle-generator, video-processorë¥¼ library-trailer-engine-main ë‚´ìš©ìœ¼ë¡œ êµì²´. veo31ì—ëŠ” Pipeline V2ìš© imageBytesBase64Â·generateVideoFromImageBuffer ìœ ì§€. nanova-bananaì—ëŠ” fetchImageAsBuffer ì¶”ê°€. |
| **ë¹„ê³ ** | .env.exampleì— BANANA_API_KEY, BANANA_MODEL_KEY ì¶”ê°€. |

---

### ì‘ì—… 12 â€” í…ŒìŠ¤íŠ¸ ê¸°ë™ ì˜¤ë¥˜ ìˆ˜ì • (ë¡œì»¬ npm run dev ë™ì‘ í™•ë³´)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-09 |
| **ìˆ˜ì •ëœ íŒŒì¼** | `library-did-main/package.json`, `packages/backend/package.json`, `packages/frontend/package.json`, `í…ŒìŠ¤íŠ¸_ì¤€ë¹„_ë°_ëª…ë ¹ì–´.md`(ê²½ë¡œÂ·Prisma ì•ˆë‚´ ìˆ˜ì •) |
| **ì¶”ê°€ëœ íŒŒì¼** | `í…ŒìŠ¤íŠ¸_ì¤€ë¹„_ë°_ëª…ë ¹ì–´.md` (í…ŒìŠ¤íŠ¸ ì¤€ë¹„Â·ëª…ë ¹ì–´Â·íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ì •ë¦¬) |
| **ë‚´ìš© ìš”ì•½** | **(1) Prisma:** ì „ì—­/ìµœì‹  Prisma 7 ì‚¬ìš© ì‹œ ìŠ¤í‚¤ë§ˆ ë¬¸ë²• ì˜¤ë¥˜ ë°œìƒ â†’ Backendì—ì„œ `npm run prisma:migrate:deploy`, `npm run prisma:generate` ë¡œ ë¡œì»¬ Prisma 5 ì‚¬ìš©í•˜ë„ë¡ ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€. **(2) Worker @smart-did/shared:** shared íŒ¨í‚¤ì§€ ë¯¸ë¹Œë“œ ì‹œ "Cannot find module '@smart-did/shared'" â†’ ë£¨íŠ¸ `dev:worker` ìŠ¤í¬ë¦½íŠ¸ë¥¼ `npm run build --workspace=@smart-did/shared && npm run dev --workspace=@smart-did/worker` ë¡œ ë³€ê²½í•´ ê¸°ë™ ì „ shared ë¹Œë“œ. **(3) Backend Fastify:** Fastify 5 + @fastify/cors 8Â·@fastify/jwt 10 ì¡°í•©ì—ì„œ í”ŒëŸ¬ê·¸ì¸ ë²„ì „ ë¶ˆì¼ì¹˜ â†’ Backendë¥¼ Fastify ^4.28.0, @fastify/jwt ^8.0.0 ìœ¼ë¡œ ë§ì¶¤. **(4) í…ŒìŠ¤íŠ¸ ë¬¸ì„œ:** DB ë§ˆì´ê·¸ë ˆì´ì…˜ ê²½ë¡œ(`packages/backend` ê¸°ì¤€), npx prisma ëŒ€ì‹  npm run ì‚¬ìš© ì•ˆë‚´ ë°˜ì˜. **(5) Frontend:** postcss.config.js ê´€ë ¨ MODULE_TYPELESS_PACKAGE_JSON ê²½ê³  ì œê±°ë¥¼ ìœ„í•´ `packages/frontend/package.json`ì— `"type": "module"` ì¶”ê°€. |
| **ë¹„ê³ ** | Redis ì‹¤í–‰, .env í•„ìˆ˜ê°’(GEMINI_API_KEY ë“±), `cd packages/backend` í›„ Prisma ë§ˆì´ê·¸ë ˆì´ì…˜Â·generate í•„ìš”. ìƒì„¸ëŠ” `í…ŒìŠ¤íŠ¸_ì¤€ë¹„_ë°_ëª…ë ¹ì–´.md` ì°¸ê³ . |

---

### ì‘ì—… 13 â€” Worker ì§„ì…ì  Pipeline V2 ì „í™˜ (1ë‹¨ê³„)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-09 |
| **ìˆ˜ì •ëœ íŒŒì¼** | `packages/worker/src/worker.ts` |
| **ì¶”ê°€ëœ íŒŒì¼** | ì—†ìŒ |
| **ë‚´ìš© ìš”ì•½** | **ì§„ì…ì  ì „í™˜:** `videoGeneratorService.generateVideo()` í˜¸ì¶œ ì œê±°. `PipelineOrchestratorV2` + `GeminiProviderAdapter` ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•´ Job ì²˜ë¦¬ ì‹œ `pipelineOrchestrator.execute(request)` í˜¸ì¶œ. **ë§¤í•‘:** `VideoJobData`(bookId, title, author, summary) â†’ `VideoGenerationRequest`(title, author, language: 'ko') ë³€í™˜ í•¨ìˆ˜ `toVideoGenerationRequest()` ì¶”ê°€. **ê²°ê³¼ ì²˜ë¦¬:** ë°˜í™˜ê°’ `status === 'completed'`ì´ë©´ `notifyBackendVideoCallback(READY, videoUrl, subtitleUrl)`, ê·¸ ì™¸ë©´ `notifyBackendVideoCallback(FAILED, errorMessage)`. ê¸°ì¡´ Backend ì½œë°± í˜•ì‹Â·ì—ëŸ¬ ì‹œ ì¬throw ë™ì‘ ìœ ì§€. |
| **ë¹„ê³ ** | Pipeline V2 ë‚´ë¶€ Step 7(Assembly)ì€ ì•„ì§ placeholder. ì‹¤ì œ ì˜ìƒ íŒŒì¼ ê²½ë¡œÂ·FFmpeg ì—°ë™ì€ 2ë‹¨ê³„(FFmpeg ì‹¤ì œ ì—°ë™)ì—ì„œ ì§„í–‰. |

---

### ì‘ì—… 14 â€” í”„ë¡ íŠ¸ì—”ë“œ: DID ì˜ìƒ ì¬ìƒÂ·í”„ë¡œí† íƒ€ì…(/pip) ë° ì˜ìƒ URL ìˆ˜ì •

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-11 |
| **ìˆ˜ì •ëœ íŒŒì¼** | `packages/frontend/src/pages/did/DidVideoPlayer.tsx`, `packages/frontend/src/App.tsx` |
| **ì¶”ê°€ëœ íŒŒì¼** | `packages/frontend/src/vite-env.d.ts` |
| **ë‚´ìš© ìš”ì•½** | **(1) ì˜ìƒ URL ìˆ˜ì •:** ë°±ì—”ë“œëŠ” `GET /api/videos/:filename`ìœ¼ë¡œ ì„œë¹™í•˜ëŠ”ë°, í”„ë¡ íŠ¸ê°€ ìƒëŒ€ ê²½ë¡œ videoUrlì„ ì¡°í•©í•  ë•Œ `/api`ë¥¼ ì œê±°í•´ `.../videos/xxx.mp4`ë¡œ ìš”ì²­í•˜ë˜ ë¬¸ì œ ìˆ˜ì •. API baseë¥¼ `/api` í¬í•¨í•œ ê°’ìœ¼ë¡œ ë‘ì–´ `.../api/videos/xxx.mp4`ë¡œ ìš”ì²­í•˜ë„ë¡ ë³€ê²½. **(2) /pip ë¼ìš°íŠ¸:** í”„ë¡œí† íƒ€ì…ìš©ìœ¼ë¡œ `/pip` â†’ `/did/video/ISBN-001` ë¦¬ë‹¤ì´ë ‰íŠ¸, `/pip/:bookId` â†’ DidVideoPlayer í‘œì‹œ ì¶”ê°€. **(3) í”„ë¡œí† íƒ€ì… fallback:** API ì˜ìƒ ë¡œë“œ ì‹¤íŒ¨ ì‹œ onErrorì—ì„œ ìƒ˜í”Œ ì˜ìƒ URLë¡œ ì „í™˜; ì—ëŸ¬/ìƒì„± ì¤‘ ìƒíƒœì—ì„œ videoUrlì´ ì—†ìœ¼ë©´ 3ì´ˆ í›„ ë™ì¼ ìƒ˜í”Œ ì¬ìƒ. `VITE_PROTOTYPE_FALLBACK_VIDEO`ë¡œ URL ì˜¤ë²„ë¼ì´ë“œ ê°€ëŠ¥. **(4) íƒ€ì…:** import.meta.env íƒ€ì… ì—ëŸ¬ ë°©ì§€ë¥¼ ìœ„í•´ vite-env.d.ts ì¶”ê°€, DidVideoPlayerì—ì„œ envë¥¼ ë³€ìˆ˜ë¡œ ì¶”ì¶œí•´ ì‚¬ìš©. |
| **ë¹„ê³ ** | ì‹œë“œ ë„ì„œ ISBN-001ì— READY ì˜ìƒì´ ìˆìœ¼ë©´ /pipì—ì„œ ì¬ìƒ. ì—†ê±°ë‚˜ 404ë©´ fallback ìƒ˜í”Œ ì¬ìƒ. |

---

### ì‘ì—… 15 â€” ë°±ì—”ë“œ ê¸°ë™ ì˜¤ë¥˜ ìˆ˜ì • (tsx watchÂ·Fastify 5 í”ŒëŸ¬ê·¸ì¸)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-11 |
| **ìˆ˜ì •ëœ íŒŒì¼** | `packages/backend/package.json` |
| **ì¶”ê°€ëœ íŒŒì¼** | ì—†ìŒ |
| **ë‚´ìš© ìš”ì•½** | **(1) tsx watch ì œê±°:** dev ìŠ¤í¬ë¦½íŠ¸ë¥¼ `tsx watch src/index.ts` â†’ `tsx src/index.ts`ë¡œ ë³€ê²½. ì¼ë¶€ í™˜ê²½ì—ì„œ `tsx watch`ê°€ IPC íŒŒì´í”„ ìƒì„± ì‹œ EPERM(operation not permitted) ë°œìƒí•˜ë¯€ë¡œ watch ì—†ì´ ì‹¤í–‰í•˜ë„ë¡ ìˆ˜ì •. **(2) Fastify 5 í”ŒëŸ¬ê·¸ì¸ í˜¸í™˜:** ë°±ì—”ë“œëŠ” Fastify 5.7.4 ì‚¬ìš© ì¤‘ì¸ë°, ê¸°ì¡´ @fastify/* í”ŒëŸ¬ê·¸ì¸ì´ Fastify 4ìš©ì´ë¼ "expected '4.x' fastify version" ì˜¤ë¥˜ ë°œìƒ. ë‹¤ìŒ ë²„ì „ìœ¼ë¡œ ì—…ê·¸ë ˆì´ë“œ: @fastify/cors ^8.5.0 â†’ ^10.0.0, @fastify/helmet ^11.1.1 â†’ ^12.0.0, @fastify/swagger ^8.13.0 â†’ ^9.0.0, @fastify/swagger-ui ^2.1.0 â†’ ^5.0.0. |
| **ë¹„ê³ ** | ì½”ë“œ ìˆ˜ì • í›„ ìë™ ì¬ì‹¤í–‰ì´ í•„ìš”í•˜ë©´ nodemon ë“±ìœ¼ë¡œ dev ìŠ¤í¬ë¦½íŠ¸ êµì²´ ê°€ëŠ¥. |

---

### ì‘ì—… 16 â€” Worker .env ë¡œë“œ ê²½ë¡œ ìˆ˜ì • ë° ê¸°ë™ ì‹œ í‚¤ ë¡œë“œ ë¡œê·¸

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-11 |
| **ìˆ˜ì •ëœ íŒŒì¼** | `packages/worker/src/config/index.ts`, `packages/worker/src/index.ts` |
| **ì¶”ê°€ëœ íŒŒì¼** | ì—†ìŒ |
| **ë‚´ìš© ìš”ì•½** | **(1) .env ê²½ë¡œ ìˆ˜ì •:** configì˜ dotenvê°€ `path.resolve(__dirname, '../../../.env')`ë¥¼ ì‚¬ìš©í•´ `packages/.env`ë¥¼ ì°¸ì¡°í•˜ê³  ìˆì–´, ì‹¤ì œ .envê°€ ìˆëŠ” `library-did-main/.env`ë¥¼ ì½ì§€ ëª»í•¨. `library-did-main/.env`ë¥¼ ì°¾ë„ë¡ ì—¬ëŸ¬ ê²½ë¡œ(../../../../.env, ../../../.env, process.cwd() ê¸°ì¤€ .env ë“±)ë¥¼ ìˆœì„œëŒ€ë¡œ ì‹œë„í•˜ë„ë¡ ë³€ê²½. **(2) ê¸°ë™ ì‹œ í‚¤ ë¡œë“œ ë¡œê·¸:** Worker ê¸°ë™ ì‹œ GEMINI_API_KEY, OPENAI_API_KEY(Sora), VEO_API_KEYê°€ set/NOT SETì¸ì§€ë§Œ ë¡œê·¸ë¡œ ì¶œë ¥(í‚¤ ê°’ì€ ë…¸ì¶œí•˜ì§€ ì•ŠìŒ). í‚¤ ë¯¸ì„¤ì • ì‹œ 403Â·No video provider ì›ì¸ í™•ì¸ ìš©ì´. |
| **ë¹„ê³ ** | .envëŠ” `library-did-main/.env` í•œ ê³³ì— ë‘ê³ , Worker ì¬ì‹œì‘ í›„ ë¡œê·¸ì—ì„œ "set" í™•ì¸. |

---

### ì‘ì—… 17 â€” MVP: Mock ë„ì„œë¡œ ì˜ìƒ ìƒì„± (ALPAS Mock ì „í™˜)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-11 |
| **ìˆ˜ì •ëœ íŒŒì¼** | `packages/backend/src/services/alpas.service.ts`, `packages/frontend/src/App.tsx` |
| **ì¶”ê°€ëœ íŒŒì¼** | ì—†ìŒ |
| **ë‚´ìš© ìš”ì•½** | **(1) Backend:** `alpas.service.ts`ë¥¼ ì‹¤ì œ ALPAS API ëŒ€ì‹  **Mock**(`alpas.service.mock.ts`)ì„ ì‚¬ìš©í•˜ë„ë¡ ë³€ê²½. DIDÂ·ë„ì„œ ìƒì„¸Â·ê²€ìƒ‰Â·ì˜ìƒ ìš”ì²­ì´ ëª¨ë‘ **MOCK_BOOKS**(BK001~BK035, 35ê¶Œ) ê¸°ì¤€ìœ¼ë¡œ ë™ì‘. ì‹¤ì œ API ì‚¬ìš© ì‹œ `alpas.service.ts`ì—ì„œ `from './alpas-real.service'` ë¡œ exportë§Œ ë°”ê¾¸ë©´ ë¨. **(2) Frontend:** í”„ë¡œí† íƒ€ì… `/pip` ê¸°ë³¸ ì´ë™ì„ ISBN-001 â†’ **BK001**(Mock ë„ì„œ ID)ë¡œ ë³€ê²½. |
| **ë¹„ê³ ** | Mock ë„ì„œ 35ê¶Œìœ¼ë¡œ DID í…Œë§ˆë³„ ëª©ë¡Â·ì˜ìƒ ìƒì„± ìš”ì²­Â·Worker íŒŒì´í”„ë¼ì¸ E2E ê²€ì¦ ê°€ëŠ¥. |

---

### ì‘ì—… 18 â€” Sora API ì—”ë“œí¬ì¸íŠ¸ ìˆ˜ì • ë° ì½œë°± 401 ì•ˆë‚´

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-11 |
| **ìˆ˜ì •ëœ íŒŒì¼** | `packages/worker/src/services/sora-client.ts`, `packages/worker/src/services/veo.service.ts`, `.env.example`, `ê°œë°œ docs/ê°œë°œ_ê¸°ë¡.md` |
| **ì¶”ê°€ëœ íŒŒì¼** | ì—†ìŒ |
| **ë‚´ìš© ìš”ì•½** | **(1) Sora 405 ìˆ˜ì •:** Workerê°€ ì‚¬ìš©í•˜ë˜ `POST /v1/videos/generations`ëŠ” OpenAI ê³µì‹ ìŠ¤í™ì´ ì•„ë‹˜. ê³µì‹ì€ `POST /v1/videos`(ìƒì„±) â†’ `GET /v1/videos/{id}`(í´ë§) â†’ `GET /v1/videos/{id}/content`(ë‹¤ìš´ë¡œë“œ). sora-client.tsë¥¼ ìœ„ ìŠ¤í™ì— ë§ê²Œ ìˆ˜ì •(model: sora-2, seconds, size ë“±). **(2) VeoService í˜¸í™˜:** Soraê°€ ì´ì œ URLì´ ì•„ë‹Œ bufferë§Œ ë°˜í™˜í•˜ë¯€ë¡œ, veo.serviceì˜ generateWithSoraì—ì„œ videoBufferì¼ ë•Œ ì„ì‹œ íŒŒì¼ë¡œ ì €ì¥ í›„ file URL ë°˜í™˜í•˜ë„ë¡ ì²˜ë¦¬. **(3) ì½œë°± 401:** Workerâ†’Backend ì½œë°± ì‹œ 401ì´ ë‚˜ì˜¤ë©´ Backendì™€ Workerì˜ `INTERNAL_API_SECRET`(ë˜ëŠ” JWT_SECRET fallback) ê°’ì´ **ë™ì¼í•œì§€** í™•ì¸. .env í•œ ê³³(library-did-main/.env)ì„ ë‘ ì•±ì´ ê³µí†µìœ¼ë¡œ ì“°ë©´ ì¼ì¹˜í•¨. |
| **ë¹„ê³ ** | Sora APIëŠ” ì¡°ì§ ê²€ì¦Â·ì´ˆëŒ€ ê¸°ë°˜ ì ‘ê·¼ì¼ ìˆ˜ ìˆìŒ. 405 í•´ê²° í›„ì—ë„ 403/402 ë“±ì´ ë‚˜ì˜¤ë©´ OpenAI ëŒ€ì‹œë³´ë“œì—ì„œ ë¹„ë””ì˜¤ API ê¶Œí•œ í™•ì¸. |

---

### ì‘ì—… 19 â€” 3ì¥ë©´ FFmpeg ë³‘í•© ì ìš© (trailer-engine assemble ì—°ë™)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-11 |
| **ìˆ˜ì •ëœ íŒŒì¼** | `packages/worker/src/pipeline/assemble.ts`, `packages/worker/src/pipeline/orchestrator.ts` |
| **ì¶”ê°€ëœ íŒŒì¼** | ì—†ìŒ |
| **ë‚´ìš© ìš”ì•½** | **(1) assemble.ts:** trailer-engineê³¼ ë™ì¼í•œ VideoAssemblerì— **concatAndSubtitles(scenes, subtitlePath, outputPath)** ì¶”ê°€. concat(FFmpeg) â†’ ìë§‰ burnë§Œ ìˆ˜í–‰(íƒ€ì´í‹€ ì¹´ë“œ ì œì™¸). concat ë¦¬ìŠ¤íŠ¸ëŠ” **íŒŒì¼ëª…ë§Œ** ì‚¬ìš©í•´ Windows/ê²½ë¡œ ì´ìŠˆ ë°©ì§€. addSubtitlesì—ì„œ ê²½ë¡œ **ë°±ìŠ¬ë˜ì‹œ â†’ ìŠ¬ë˜ì‹œ** ì •ê·œí™”. **(2) orchestrator Step 7:** ì„±ê³µí•œ ì¥ë©´ì„ sceneNumber ìˆœìœ¼ë¡œ ì •ë ¬ í›„, tempDirì— scene-1.mp4Â·scene-2.mp4Â·scene-3.mp4ì™€ VTT íŒŒì¼ ê¸°ë¡ â†’ VideoAssembler.concatAndSubtitles í˜¸ì¶œ â†’ ë³‘í•©ëœ íŒŒì¼ì„ storageì— ì €ì¥ í›„ videoUrl ë°˜í™˜. FFmpeg ë¯¸ì„¤ì¹˜ ë˜ëŠ” ë³‘í•© ì‹¤íŒ¨ ì‹œ **ì²« ë²ˆì§¸ ì¥ë©´ë§Œ** ì €ì¥í•˜ëŠ” fallback ìœ ì§€. **(3) ì •ë¦¬:** temp ë””ë ‰í„°ë¦¬ ì‚­ì œ, ë¶ˆí•„ìš”í•œ import(TypographyPlan) ì œê±°. |
| **ë¹„ê³ ** | FFmpeg ì„¤ì¹˜ í•„ìš”. ìë§‰ burn ì‹œ Noto Sans KR ë“± ì§€ì • í°íŠ¸ê°€ ì—†ìœ¼ë©´ addSubtitles ë‹¨ê³„ì—ì„œ ì‹¤íŒ¨í•  ìˆ˜ ìˆìŒ(ì‹¤íŒ¨ ì‹œ fallbackìœ¼ë¡œ ì²« ì¥ë©´ë§Œ ì €ì¥). |

---

### ì‘ì—… 20 â€” Admin í˜ì´ì§€ DID ë™ì¼ ë·°í¬íŠ¸(480px) ë° DID ë ˆì´ì•„ì›ƒ í”ë“¤ë¦¼ ë°©ì§€

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-13 |
| **ìˆ˜ì •ëœ íŒŒì¼** | `packages/frontend/src/App.tsx`, `packages/frontend/src/pages/admin/Login.tsx`, `packages/frontend/src/pages/admin/Dashboard.tsx`, `packages/frontend/src/pages/admin/VideoManagement.tsx`, `packages/frontend/src/pages/did/DidV2BookDetail.tsx`, `packages/frontend/src/pages/did/DidV2Layout.tsx`, `packages/frontend/src/index.css` |
| **ì¶”ê°€ëœ íŒŒì¼** | `packages/frontend/src/pages/admin/AdminLayout.tsx`, `packages/frontend/src/pages/admin/AdminRecommendBook.tsx` |
| **ë‚´ìš© ìš”ì•½** | **(1) Admin ë ˆì´ì•„ì›ƒ:** DIDì™€ ë™ì¼í•œ 480px ë·°í¬íŠ¸ë¡œ `AdminLayout` ì¶”ê°€. ìƒë‹¨ ê²€ì • í—¤ë” "BOOK MATE ê´€ë¦¬ì", ëŒ€ì‹œë³´ë“œ ì™¸ í˜ì´ì§€ì—ì„œ "â† ëŒ€ì‹œë³´ë“œ" ë²„íŠ¼ í‘œì‹œ. **(2) Admin ëŒ€ì‹œë³´ë“œ:** API ì‚¬ìš© í˜„í™©(ì´ ìƒì„± ìˆ˜, ì‚¬ìš© ë¹„ìš©, ì”ì—¬ ì˜ˆì‚°, ìƒì„± ê°€ëŠ¥ ê°œìˆ˜), ì‚¬ì„œ ì¶”ì²œ ë„ì„œ ì¶”ê°€(ì±… ì œëª© + "+ ì¶”ì²œë„ì„œ ë“±ë¡" ë²„íŠ¼ â†’ /admin/recommend), ì¸ê¸° ì‚¬ìš© ì±…, ì´ìš©ì ìƒì„± ë¡œê·¸(ê²€ìƒ‰Â·í…Œì´ë¸” í—¤ë”Â·ë¹ˆ ìƒíƒœ), í•˜ë‹¨ ë¹¨ê°„ ì•ˆë‚´ ë¬¸êµ¬. **(3) ì¶”ì²œë„ì„œ ë“±ë¡:** `/admin/recommend` í˜ì´ì§€ ì¶”ê°€. ì œëª©, ì—°ë ¹ëŒ€, ì§ˆë¬¸(ìë§‰), íƒœê·¸, ì»¤ë²„(ì´ëª¨ì§€), ì¡´ ìƒìƒ, ì±…ì¥/ì¤„, "ğŸ“’ ë“±ë¡í•˜ê¸° (ë©”ì¸ì— ë…¸ì¶œ)" ë²„íŠ¼. **(4) ì˜ìƒ ê´€ë¦¬:** AdminLayout ì ìš©, 480pxì— ë§ì¶° ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ í˜•íƒœë¡œ í‘œì‹œ. **(5) ë¡œê·¸ì¸:** 480px ì¤‘ì•™ ë˜í¼ë¡œ DIDì™€ ë™ì¼ ë„ˆë¹„. **(6) ì±… ë¯¸ë¦¬ë³´ê¸°:** "ì´ ì±…ì€ ì—¬ê¸° ìˆì–´ìš”! {ì œëª©}" ë¬¸êµ¬ë¥¼ ì±… ë¯¸ë¦¬ë³´ê¸°(DidV2BookDetail)ì—ì„œ ì œê±° â†’ ìœ„ì¹˜ ì•ˆë‚´ í˜ì´ì§€(DidV2Location)ì—ì„œë§Œ ë…¸ì¶œ. **(7) /did í˜ì´ì§€ ì´ë™ ì‹œ ë ˆì´ì•„ì›ƒ í”ë“¤ë¦¼ ë°©ì§€:** DidV2Layoutì˜ mainì— `scrollbar-gutter: stable` ì ìš©, ë ˆì´ì•„ì›ƒ ë£¨íŠ¸ì— `overflow-x-hidden`Â·`max-w-[480px]`. index.cssì— html `scrollbar-gutter: stable`, body `overflow-x: hidden` ì¶”ê°€. |
| **ë¹„ê³ ** | ê´€ë¦¬ì ê¸°ë³¸ ê³„ì •: admin / admin1234. ì¶”ì²œë„ì„œ ë“±ë¡ ì œì¶œì€ ë°±ì—”ë“œ API ì—°ë™ í›„ ì—°ë™ ì˜ˆì •. |

---

### ì‘ì—… 21 â€” DID í—¤ë” ë¡œê³  ì œê±° ë° ìƒë‹¨ ì œëª© ë¯¸í‘œì‹œ

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-13 |
| **ìˆ˜ì •ëœ íŒŒì¼** | `packages/frontend/src/pages/did/DidV2Layout.tsx` |
| **ì¶”ê°€ëœ íŒŒì¼** | ì—†ìŒ |
| **ë‚´ìš© ìš”ì•½** | **(1) ë¡œê³  ì œê±°:** ë¶ë©”ì´íŠ¸ ì™¼ìª½ì— ìˆë˜ ğŸ“š ë¡œê³ (ì•„ì´ì½˜ ë°•ìŠ¤) ì œê±°. **(2) ìƒë‹¨ ì œëª© ë¯¸í‘œì‹œ:** í—¤ë” ê°€ìš´ë°ì— í‘œì‹œë˜ë˜ í˜ì´ì§€/ì±… ì œëª©ì„ ë” ì´ìƒ í‘œì‹œí•˜ì§€ ì•ŠìŒ. ìƒë‹¨ë°”ì—ëŠ” ì™¼ìª½ì˜ "BookMate / ë¶ë©”ì´íŠ¸" í…ìŠ¤íŠ¸ë§Œ ìœ ì§€. **(3) ë¹„ê³ :** ì±… ìƒì„¸ ë“±ì—ì„œ ê¸´ ì œëª©ìœ¼ë¡œ ì¸í•œ ë ˆì´ì•„ì›ƒ ê¹¨ì§ ì´ìŠˆë¥¼ ì—†ì• ê¸° ìœ„í•œ ë³€ê²½. |
| **ë¹„ê³ ** | ì‚¬ìš©ì ìš”ì²­: ìƒë‹¨ë°”ëŠ” ìœ ì§€í•˜ë˜ ë¡œê³ ë§Œ ì œê±°, í—¤ë”ì— ì œëª©ì€ í‘œì‹œí•˜ì§€ ì•Šê¸°. |

---

### ì‘ì—… 22 â€” ì±… ìƒì„¸ ì¡°íšŒ(getBookDetail) í™•ëŒ€

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-13 |
| **ìˆ˜ì •ëœ íŒŒì¼** | `packages/backend/src/services/alpas-real.service.ts`, `ê°œë°œ docs/ê°œë°œ_ê¸°ë¡.md` |
| **ì¶”ê°€ëœ íŒŒì¼** | ì—†ìŒ |
| **ë‚´ìš© ìš”ì•½** | **(1) ID ë¹„êµ ì •ê·œí™”:** `normalizeId`/`idMatches` ë„ì…. APIë³„ bookIdÂ·orgNoÂ·BOOK_KEYÂ·REG_NO í˜•ì‹ ì°¨ì´(ê³µë°± ë“±)ë¥¼ í¡ìˆ˜í•´ ë§¤ì¹­ë¥  í–¥ìƒ. **(2) AD201 POST ëª©ë¡ í™•ëŒ€:** ê¸°ì¡´ 1í˜ì´ì§€ 50ê±´ â†’ 1Â·2í˜ì´ì§€ ê° 50ê±´(ìµœëŒ€ 100ê±´)ê¹Œì§€ ìˆœì°¨ ê²€ì‚¬. **(3) searchWord ê²€ìƒ‰ í™•ëŒ€:** searchWord=bookIdë¡œ POST ì‹œ ê²°ê³¼ 10ê±´ â†’ 30ê±´ìœ¼ë¡œ ì¦ê°€, ëª©ë¡ ë‚´ì—ì„œ ID ì •í™• ë§¤ì¹­ í›„ ì—†ìœ¼ë©´ ì²« í•­ëª© ë°˜í™˜. **(4) ì „ ë‹¨ê³„ ID ë§¤ì¹­:** 2Â·3Â·4Â·5ë‹¨ê³„ì—ì„œ ëª¨ë‘ idMatches ì‚¬ìš©í•´ ì¼ì¹˜ ì¡°ê±´ ì™„í™”. |
| **ë¹„ê³ ** | ì¡°íšŒ ì‹¤íŒ¨ê°€ ë§ì„ ë•Œë¥¼ ëŒ€ë¹„í•œ fallback ê°•í™”. AD206(ì±…í‚¤ ìƒì„¸) ì‹¤íŒ¨ ì‹œ ëª©ë¡/ê²€ìƒ‰/ì‹ ì°©/ì—°ë ¹ë³„ ìˆœìœ¼ë¡œ ë” ë„“ê²Œ ì°¾ìŒ. |

---

## ì•ìœ¼ë¡œ í•  ê²ƒ (ìƒì„¸)

- **FFmpeg:** video-processor ì‹¤ì œ ì—°ë™ ê²€ì¦, fluent-ffmpeg ì˜ì¡´ì„± ì„¤ì¹˜.
- **DB:** Prisma ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš©(subtitleUrl ë“±), í”„ë¡œë•ì…˜ ì‹œ PostgreSQL ì „í™˜.
- **S3:** S3StorageProvider ì‹¤ì œ êµ¬í˜„, presigned URL.
- **ALPAS API, WebSocket, E2E ë“±:** ì§„í–‰_ì²´í¬ë¦¬ìŠ¤íŠ¸ 4.2Â·4.3ì ˆ ì°¸ê³ .

---

*ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: 2026-02-15 (ì‘ì—… 22 ì±… ìƒì„¸ ì¡°íšŒ í™•ëŒ€)*
