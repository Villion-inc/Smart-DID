# Smart DID â€” ê°œë°œ ê¸°ë¡

> **ê¸°ì¤€ ë¬¸ì„œ**: `ì•„ì‚°ë„ì„œê´€_ê°œë°œ_Final.md`
> **ëª©í‘œ**: â€œì§€ê¸ˆ í”„ë¡œì íŠ¸ê°€ ì–´ë””ê¹Œì§€ ë˜ì—ˆê³ (í˜„ì¬ ìƒíƒœ), ë¬´ì—‡ì„ ì–´ë–»ê²Œ ê²€ì¦/ë°°í¬í• ì§€(ì¬í˜„ì„±)â€ê°€ í•œ ëˆˆì— ë³´ì´ê²Œ ìœ ì§€

*ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: 2026-02-28*

---

## ëª©ì°¨

- [í˜„ì¬ ìƒíƒœ ìš”ì•½](#í˜„ì¬-ìƒíƒœ-ìš”ì•½)
- [ë¡œì»¬ E2E ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸ (ì˜ìƒ ìƒì„± íŒŒì´í”„ë¼ì¸)](#ë¡œì»¬-e2e-ê²€ì¦-ì²´í¬ë¦¬ìŠ¤íŠ¸-ì˜ìƒ-ìƒì„±-íŒŒì´í”„ë¼ì¸)
- [ë°°í¬ ë©”ëª¨: ë„ì„œê´€ ì„œë²„ 10.10.11.13/METIS](#ë°°í¬-ë©”ëª¨-ë„ì„œê´€-ì„œë²„-10101113metis)
- [í™˜ê²½ë³€ìˆ˜(.env) ì •ë¦¬](#í™˜ê²½ë³€ìˆ˜env-ì •ë¦¬)
- [Known Issues / ë¦¬ìŠ¤í¬](#known-issues--ë¦¬ìŠ¤í¬)
- [ë³€ê²½ ì´ë ¥ (ìµœì‹  â†’ ê³¼ê±°)](#ë³€ê²½-ì´ë ¥-ìµœì‹ --ê³¼ê±°)

---

## í˜„ì¬ ìƒíƒœ ìš”ì•½

### í•µì‹¬ êµ¬ì„±

- **Frontend**: DID í˜ì´ì§€ + DIDìš© ê´€ë¦¬ì(480px) + ë¡œê·¸ì¸
- **Backend**: Fastify API + Prisma(DB) + BullMQ(Queue)
- **Worker**: BullMQ Worker + Pipeline V2(grounding/style/planning/video/subtitles/merge/save) + Backend callback
- **Redis**: BullMQ í
- **Storage**: ê¸°ë³¸ local (`STORAGE_PATH`), S3ëŠ” ì¶”í›„

### â€œì§€ê¸ˆ ê°€ëŠ¥í•œ ê²ƒâ€ í•œ ì¤„ ìš”ì•½

- **(E2E)** DID/ê´€ë¦¬ìì—ì„œ ì˜ìƒ ìƒì„± ìš”ì²­ â†’ BullMQ í ë“±ë¡ â†’ Worker íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ â†’ ì˜ìƒ/ìë§‰ ì €ì¥ â†’ Backend ì½œë°±ìœ¼ë¡œ ìƒíƒœ ê°±ì‹  â†’ DIDì—ì„œ ì¬ìƒ

---

## ë¡œì»¬ E2E ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸ (ì˜ìƒ ìƒì„± íŒŒì´í”„ë¼ì¸)

> ëª©ì : **ALPAS ì—°ë™ + ìƒì„± íŒŒì´í”„ë¼ì¸ ê²¬ê³ ì„±**ì„ â€œì¬í˜„ ê°€ëŠ¥í•œ ì ˆì°¨â€ë¡œ í™•ì¸

### ì‚¬ì „ ì¡°ê±´

- **Redis ì‹¤í–‰**
- **Backend ì‹¤í–‰**
- **Worker ì‹¤í–‰**
- **FFmpeg ì„¤ì¹˜** (3ì¥ë©´ ë³‘í•©/ìë§‰ burn ë‹¨ê³„ì—ì„œ í•„ìš”)
- API í‚¤ ìµœì†Œ 1ê°œ:
  - **Gemini**: `GEMINI_API_KEY` (Style/Planning/Script ë“±ì— ì‚¬ìš©)
  - **ì˜ìƒ ìƒì„±**: `OPENAI_API_KEY`(Sora) ë˜ëŠ” `VEO_API_KEY`

### 1) ALPAS ì—°ë™ í™•ì¸ (ê²€ìƒ‰/ì‹ ì°©/ìƒì„¸)

- **í™•ì¸ í¬ì¸íŠ¸**
  - ê²€ìƒ‰ ê²°ê³¼ì— **title/author/publisher** ë“± ê¸°ë³¸ í•„ë“œê°€ â€œì œëª© ì—†ìŒâ€ìœ¼ë¡œ ë¬´ë„ˆì§€ëŠ” ì¼€ì´ìŠ¤ê°€ ì—†ëŠ”ì§€
  - ì‹ ì°© ë„ì„œ í´ë¦­ ì‹œ ìƒì„¸ê°€ ëœ¨ëŠ”ì§€
  - `getBookDetail`ì´ ìºì‹œ/ëª©ë¡ ê¸°ë°˜ìœ¼ë¡œ ì°¾ë„ë¡ ë™ì‘í•˜ëŠ”ì§€

### 2) ì˜ìƒ ìƒì„± ìš”ì²­ â†’ í ë“±ë¡ í™•ì¸

- **í™•ì¸ í¬ì¸íŠ¸**
  - ìš”ì²­ ì§í›„ VideoRecord ìƒíƒœê°€ `QUEUED`
  - ì¤‘ë³µ ìš”ì²­ ì‹œ í ì¤‘ë³µ ì‚½ì…ì´ ë°©ì§€ë˜ëŠ”ì§€(ì´ë¯¸ `QUEUED`/`GENERATING`ì´ë©´ ì¬ë“±ë¡ ì œí•œ)

### 3) Worker ì²˜ë¦¬ + ì €ì¥ + ì½œë°± í™•ì¸

- **í™•ì¸ í¬ì¸íŠ¸**
  - Workerê°€ Jobì„ ë°›ì•„ íŒŒì´í”„ë¼ì¸ì„ ëê¹Œì§€ ìˆ˜í–‰í•˜ëŠ”ì§€
  - ê²°ê³¼ë¬¼:
    - **videoUrl**: `/api/videos/...mp4` í˜•íƒœ
    - **subtitleUrl**: `/api/videos/...vtt` í˜•íƒœ (ìë§‰ë„ ì €ì¥í•˜ë„ë¡ ìˆ˜ì •ë¨)
  - **Backend ì½œë°± ê²¬ê³ ì„±**:
    - callback ì‹¤íŒ¨ ì‹œ **ìµœëŒ€ 3íšŒ ì¬ì‹œë„(ì§€ìˆ˜ ë°±ì˜¤í”„)**ê°€ ë™ì‘í•˜ëŠ”ì§€
    - SECRET ë¶ˆì¼ì¹˜ ì‹œ 401ì´ ë‚˜ë©° ì›ì¸ì´ ëª…í™•í•œì§€

---

## ë°°í¬ ë©”ëª¨: ë„ì„œê´€ ì„œë²„ 10.10.11.13/METIS

ë„ì„œê´€ ì¸¡ì´ `/METIS` ê²½ë¡œë¡œ ì„œë¹„ìŠ¤í•˜ëŠ” ìš”êµ¬ì‚¬í•­ì„ ë°˜ì˜í–ˆìŠµë‹ˆë‹¤.

- **ì ‘ì† URL**
  - DID: `http://10.10.11.13/METIS`
  - Admin: `http://10.10.11.13/METIS/admin/login`
- **í”„ë¡ íŠ¸ base path**
  - ë¹Œë“œ ì‹œ `VITE_BASE_PATH=/METIS` ì ìš©
  - React RouterëŠ” `import.meta.env.BASE_URL` ê¸°ë°˜ `basename` ì‚¬ìš©
- **nginx**
  - `location /METIS` â†’ SPA (ì •ì  íŒŒì¼)
  - `location /METIS/api/` â†’ Backend í”„ë¡ì‹œ
- **SSL**
  - ì•„ì‚°ì‹œ SSL ì¸ì¦ì„œëŠ” ë„ì„œê´€ ì¸¡ ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œì—ì„œ ì ìš©(ìš°ë¦¬ ì•± ë‚´ë¶€ì—ì„œ ì²˜ë¦¬í•˜ì§€ ì•ŠìŒ)

---

## í™˜ê²½ë³€ìˆ˜(.env) ì •ë¦¬

> **ì£¼ì˜**: í‚¤/ë¹„ë°€ë²ˆí˜¸ëŠ” ë¬¸ì„œì— â€œì‹¤ì œ ê°’â€ì„ ì ì§€ ì•ŠìŠµë‹ˆë‹¤. ì˜ˆì‹œëŠ” ëª¨ë‘ placeholderë¡œ ìœ ì§€í•©ë‹ˆë‹¤.

### í•„ìˆ˜

| ë³€ìˆ˜ëª… | ìš©ë„ | ë¹„ê³  |
|--------|------|------|
| `DATABASE_URL` | Prisma DB | SQLite ë˜ëŠ” PostgreSQL |
| `JWT_SECRET` | ê´€ë¦¬ì ë¡œê·¸ì¸/ì¸ì¦ | 32ì ì´ìƒ |
| `INTERNAL_API_SECRET` | Worker â†’ Backend ì½œë°± ì¸ì¦ | **Backend/Worker ë™ì¼ ê°’ í•„ìˆ˜** |
| `REDIS_HOST` / `REDIS_PORT` | BullMQ Redis | |
| `BACKEND_URL` | Worker ì½œë°± ëŒ€ìƒ Backend ì£¼ì†Œ | ì˜ˆ: `http://localhost:3001` |
| `GEMINI_API_KEY` | íŒŒì´í”„ë¼ì¸ í…ìŠ¤íŠ¸ ìƒì„± | |

### ì„ íƒ(ê¸°ëŠ¥ë³„)

| ë³€ìˆ˜ëª… | ìš©ë„ | ë¹„ê³  |
|--------|------|------|
| `OPENAI_API_KEY` | Sora ë¹„ë””ì˜¤ ìƒì„± | ì—†ìœ¼ë©´ VEOë¡œ ëŒ€ì²´ |
| `VEO_API_KEY` | Veo ë¹„ë””ì˜¤ ìƒì„± | ì—†ìœ¼ë©´ Sora í•„ìš” |
| `BANANA_API_KEY` / `BANANA_MODEL_KEY` | í‚¤í”„ë ˆì„ ì´ë¯¸ì§€ ìƒì„± | ì—†ìœ¼ë©´ placeholder í‚¤í”„ë ˆì„ |
| `STORAGE_TYPE` / `STORAGE_PATH` | ì €ì¥ì†Œ | ê¸°ë³¸ local |
| `WORKER_CONCURRENCY` | Worker ë™ì‹œ ì‹¤í–‰ | ê¸°ë³¸ 2 |

### ìµœì†Œ ì˜ˆì‹œ

```env
DATABASE_URL=file:./dev.db
JWT_SECRET=your-secret-key-change-in-production-32chars
INTERNAL_API_SECRET=your-internal-secret-change-in-production
REDIS_HOST=localhost
REDIS_PORT=6379
BACKEND_URL=http://localhost:3001
GEMINI_API_KEY=YOUR_GEMINI_API_KEY

# ë‘˜ ì¤‘ í•˜ë‚˜ ì´ìƒ í•„ìš”
OPENAI_API_KEY=YOUR_OPENAI_KEY
# VEO_API_KEY=YOUR_VEO_KEY

STORAGE_TYPE=local
STORAGE_PATH=./storage/videos
WORKER_CONCURRENCY=2
```

---

## Known Issues / ë¦¬ìŠ¤í¬

- **FFmpeg ì˜ì¡´ì„±**: ì„¤ì¹˜/ì‹¤í–‰ í™˜ê²½ì— ë”°ë¼ ë³‘í•©(Concat)Â·ìë§‰ burn ë‹¨ê³„ê°€ ì‹¤íŒ¨í•  ìˆ˜ ìˆìŒ â†’ ì‹¤íŒ¨ ì‹œ â€œì²« ì¥ë©´ë§Œ ì €ì¥â€ fallbackì´ ë™ì‘í•˜ë„ë¡ ë˜ì–´ ìˆìŒ.
- **ì™¸ë¶€ API ë³€ë™ì„±**: Sora/Veo/GeminiëŠ” ì¿¼í„°Â·ê¶Œí•œÂ·ì‘ë‹µ ì§€ì—° ì´ìŠˆ ê°€ëŠ¥ â†’ ì¬ì‹œë„/íƒ€ì„ì•„ì›ƒ ê´€ì°° í•„ìš”.
- **ë¶€ë¶„ ì„±ê³µ ì²˜ë¦¬**: 1~2ê°œ ì¥ë©´ë§Œ ì„±ê³µí•´ë„ ê²°ê³¼ê°€ â€œcompletedâ€ë¡œ ì²˜ë¦¬ë˜ëŠ” êµ¬ê°„ì´ ìˆì–´, ìš´ì˜ ì •ì±…ì— ë”°ë¼ ìƒíƒœ ì²´ê³„ ì¬ì •ì˜ê°€ í•„ìš”í•  ìˆ˜ ìˆìŒ.
- **í/DB ìƒíƒœ ë¶ˆì¼ì¹˜**: ì½œë°±ì´ ì˜êµ¬ ì‹¤íŒ¨í•˜ë©´ DBê°€ ìµœì‹  ìƒíƒœë¥¼ ëª» ë°›ì„ ìˆ˜ ìˆìŒ â†’ ì½œë°± ì¬ì‹œë„ëŠ” ì¶”ê°€í–ˆì§€ë§Œ, ê¶ê·¹ì ìœ¼ë¡œ â€œìƒíƒœ ë¦¬ì»¨ì‹¤ë¦¬ì—ì´ì…˜(ì¬ë™ê¸°í™”)â€ ì‘ì—…ì´ í•„ìš”í•  ìˆ˜ ìˆìŒ.

---

## ë³€ê²½ ì´ë ¥ (ìµœì‹  â†’ ê³¼ê±°)

> ì›ë³¸ ë¡œê·¸ì˜ â€œì‘ì—… 1~20â€ í˜•ì‹ì€ ìœ ì§€í•˜ë˜, **í˜„ì¬ ì½”ë“œ ê¸°ì¤€ìœ¼ë¡œ ì •í•©ì„±**ì„ ë§ì¶”ê³  ë¶ˆí•„ìš”í•œ ì¤‘ë³µì„ ì¤„ì˜€ìŠµë‹ˆë‹¤.

### ì‘ì—… 24 â€” DID ì˜ìƒ í”Œë ˆì´ì–´ UX ê°œì„  (ìë™ ì¬ìƒ + ë‹¤ì‹œë³´ê¸°)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-28 |
| **ìˆ˜ì •ëœ íŒŒì¼** | `packages/frontend/src/pages/did/DidV2BookDetail.tsx`, `packages/frontend/src/pages/did/DidV2Location.tsx` |
| **ë‚´ìš© ìš”ì•½** | (1) **DidV2BookDetail**: ì˜ìƒ ìë™ ì¬ìƒ ê¸°ëŠ¥ ì¶”ê°€. ì˜ìƒ ì¢…ë£Œ ì‹œ ë°˜íˆ¬ëª… ì˜¤ë²„ë ˆì´ì™€ ì¬ìƒ ë²„íŠ¼(ë‹¤ì‹œë³´ê¸°) í‘œì‹œ. controls ì†ì„± ì œê±°í•˜ì—¬ ê¹”ë”í•œ ì „ì²´í™”ë©´ ì¬ìƒ UX ì œê³µ. (2) **DidV2Location**: ë„ì„œê´€ ì§€ë„ placeholderë¥¼ ì£¼ì„ ì²˜ë¦¬(ì§€ë„ ë°ì´í„° ì¤€ë¹„ ì „ê¹Œì§€ ìˆ¨ê¹€). TODO ì£¼ì„ìœ¼ë¡œ í–¥í›„ ì—°ë™ ì•ˆë‚´ ì¶”ê°€. |
| **ë¹„ê³ ** | í‚¤ì˜¤ìŠ¤í¬ í™˜ê²½ì—ì„œ ì‚¬ìš©ìê°€ ë³„ë„ ì¡°ì‘ ì—†ì´ ì˜ìƒì„ ì‹œì²­í•˜ê³ , ì¢…ë£Œ í›„ ë‹¤ì‹œë³´ê¸°í•  ìˆ˜ ìˆë„ë¡ ê°œì„ . |

---

### ì‘ì—… 23 â€” íŒŒì´í”„ë¼ì¸ ê²¬ê³ ì„± ë³´ê°• (ì½œë°± ì¬ì‹œë„, ìë§‰ ì €ì¥, Worker ë¹Œë“œ ì •ë¦¬)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-25 |
| **ìˆ˜ì •ëœ íŒŒì¼** | `packages/worker/src/services/backend-callback.service.ts`, `packages/worker/src/pipeline/orchestrator.ts`, `packages/worker/tsconfig.json` |
| **ì‚­ì œëœ íŒŒì¼** | `packages/worker/src/services/video-processor.ts` (ë¯¸ì‚¬ìš© + fluent-ffmpeg ë¯¸ì„¤ì¹˜ë¡œ ë¹Œë“œ ì‹¤íŒ¨ ìœ ë°œ) |
| **ë‚´ìš© ìš”ì•½** | (1) Workerâ†’Backend ì½œë°±ì— **ìµœëŒ€ 3íšŒ ì¬ì‹œë„(ì§€ìˆ˜ ë°±ì˜¤í”„)** ì¶”ê°€. (2) Pipeline V2ì—ì„œ **VTT ìë§‰ë„ Storageì— ì €ì¥**í•˜ì—¬ subtitleUrlì´ ì‹¤ì œë¡œ ë™ì‘í•˜ë„ë¡ ìˆ˜ì •. (3) Worker tsconfigì— `src/**/*.json` í¬í•¨í•˜ì—¬ QC JSON import ë¹Œë“œ ì˜¤ë¥˜ ì œê±°. |

---

### ì‘ì—… 22 â€” ë„ì„œê´€ ì„œë²„ ë°°í¬(/METIS) ì§€ì›

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-25 |
| **ìˆ˜ì •ëœ íŒŒì¼** | `packages/frontend/vite.config.ts`, `packages/frontend/src/App.tsx`, `packages/frontend/src/api/client.ts`, `packages/frontend/src/pages/did/DidV2BookDetail.tsx`, `nginx.conf`, `Dockerfile.frontend`, `README.md`, `.env.example` |
| **ë‚´ìš© ìš”ì•½** | (1) Vite `base`ë¥¼ `VITE_BASE_PATH`ë¡œ ì œì–´. (2) React Router `basename`ì„ `BASE_URL` ê¸°ë°˜ìœ¼ë¡œ ì„¤ì •. (3) API baseURLê³¼ 401 ë¦¬ë‹¤ì´ë ‰íŠ¸ë¥¼ base path ì¸ì§€í•˜ë„ë¡ ìˆ˜ì •. (4) nginxë¥¼ `/METIS` í•˜ìœ„ SPA + `/METIS/api` í”„ë¡ì‹œë¡œ ë³€ê²½. (5) Docker frontendëŠ” distë¥¼ `/usr/share/nginx/html/METIS`ë¡œ ë°°ì¹˜. |

---

### ì‘ì—… 21 â€” Admin UI ê°œì„  + ë¶ˆí•„ìš” í˜ì´ì§€ ì •ë¦¬ + ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¹€

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-24 |
| **ìˆ˜ì •ëœ íŒŒì¼** | `packages/frontend/src/pages/admin/*`, `packages/frontend/src/index.css`, `packages/frontend/src/App.tsx` |
| **ì‚­ì œëœ íŒŒì¼** | `packages/frontend/src/pages/` ë‚´ DID/ê´€ë¦¬ìì™€ ë¬´ê´€í•œ í˜ì´ì§€ ë° êµ¬ë²„ì „ DID í˜ì´ì§€ ë‹¤ìˆ˜ |
| **ë‚´ìš© ìš”ì•½** | (1) Adminì„ DID ê°ì„±ì— ë§ì¶˜ UIë¡œ ê°œì„ (í—¤ë” ì¤‘ì•™ì •ë ¬ í¬í•¨). (2) ì „ì—­ ìŠ¤í¬ë¡¤ë°”ë¥¼ ìˆ¨ê¸°ë„ë¡ CSS ì ìš©. (3) ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” legacy í˜ì´ì§€/ë¼ìš°íŠ¸ ì œê±° í›„ `/`ëŠ” `/did`ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸. |

---

### ì‘ì—… 1 ~ 20 (ê¸°ì¡´ ë¡œê·¸)

> ì•„ë˜ í•­ëª©ì€ â€œë‹¹ì‹œ ì§„í–‰ ë¡œê·¸â€ë¡œ ë³´ì¡´í•©ë‹ˆë‹¤.  
> ë‹¨, ì¼ë¶€ íŒŒì¼(ì˜ˆ: `DidVideoPlayer.tsx` ê°™ì€ êµ¬ë²„ì „ DID í˜ì´ì§€)ì€ ì´í›„ ì •ë¦¬ ê³¼ì •ì—ì„œ **ì‚­ì œ/êµì²´**ë˜ì—ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<details>
<summary><strong>ì‘ì—… 1~20 í¼ì¹˜ê¸°</strong></summary>


### ì‘ì—… 1 â€” pipeline í´ë” ë³µì‚¬ (ì²´í¬ë¦¬ìŠ¤íŠ¸ 2ë²ˆ #1)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-09 |
| **ìˆ˜ì •ëœ íŒŒì¼** | ì—†ìŒ |
| **ì¶”ê°€ëœ íŒŒì¼** | `library-did-main/packages/worker/src/pipeline/` í•˜ìœ„ ì „ì²´ |
| **ì¶”ê°€ ê²½ë¡œ** | `pipeline/assemble.ts`, `pipeline/orchestrator.ts`, `pipeline/planning/index.ts`, `pipeline/planning/scenePlanner.ts`, `pipeline/style/styleBible.ts`, `pipeline/grounding/index.ts`, `pipeline/grounding/buildBookFacts.ts`, `pipeline/grounding/fetchCandidates.ts`, `pipeline/grounding/rankCandidates.ts` |
| **ë‚´ìš© ìš”ì•½** | trailer-engine `src/pipeline/` í´ë”ë¥¼ lib-mvp Workerë¡œ í†µì§¸ë¡œ ë³µì‚¬í•¨. Book Grounding, Style Bible, Scene Planning, V2 ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„° ë“± íŒŒì´í”„ë¼ì¸ ì½”ë“œê°€ worker ë‚´ë¶€ì— ìœ„ì¹˜í•¨. |
| **ë¹„ê³ ** | ë³µì‚¬ë³¸ì€ ê¸°ì¡´ trailer-engine ìƒëŒ€ ê²½ë¡œ(`../shared/types`, `../config`, `../worker/`, `../qc/`, `../anchor/`, `../cost/`, `../subtitles/`, `../cache/`)ë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ë¯€ë¡œ, ì•„ì§ ë¹Œë“œ ë¶ˆê°€. ë‹¤ìŒ ì‘ì—…ì—ì„œ qcÂ·retryÂ·servicesÂ·íƒ€ì…Â·config ë³µì‚¬Â·ë³‘í•© í›„ import ê²½ë¡œ ì •ë¦¬ ì˜ˆì •. |

---

### ì‘ì—… 2 â€” gemini-* ì„œë¹„ìŠ¤ ë³µì‚¬ + import ì •ë¦¬ (ì²´í¬ë¦¬ìŠ¤íŠ¸ 2ë²ˆ #2)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-09 |
| **ìˆ˜ì •ëœ íŒŒì¼** | `packages/worker/src/config/index.ts` â€” `geminiApiKey`, `gemini.model/temperature/maxRetries` ì¶”ê°€ |
| **ì¶”ê°€ëœ íŒŒì¼** | `packages/worker/src/services/gemini-client.ts`, `packages/worker/src/services/gemini-client-v2.ts`, `packages/worker/src/types/index.ts` |
| **ë‚´ìš© ìš”ì•½** | trailer-engineì˜ `gemini-client.ts`, `gemini-client-v2.ts`ë¥¼ worker/servicesë¡œ ë³µì‚¬. Workerì—ì„œ `../types`ê°€ ì°¸ì¡° ê°€ëŠ¥í•˜ë„ë¡ `worker/src/types/index.ts`ì— Scene, ScenePromptPayload, GeminiVideoResponse íƒ€ì… ì¶”ê°€. Configì— GEMINI ê´€ë ¨ í•„ë“œ ì¶”ê°€í•˜ì—¬ Gemini í´ë¼ì´ì–¸íŠ¸ ìƒì„±ì ë™ì‘ ê°€ëŠ¥í•˜ë„ë¡ í•¨. |
| **ë¹„ê³ ** | gemini-*ëŠ” `../config`, `../types` ì‚¬ìš© ì¤‘. íƒ€ì…ì€ ì¶”í›„ shared íŒ¨í‚¤ì§€ ë³‘í•© ì‹œ ì´ì „ ì˜ˆì •. workerì—ì„œ `npm install @google/generative-ai` ì‹¤í–‰ í•„ìš”. |

---

### ì‘ì—… 3 â€” sora-client ìŠ¤í‚µ + veo31 / video-processor / subtitle-generator ë³µì‚¬ (ì²´í¬ë¦¬ìŠ¤íŠ¸ 2ë²ˆ #3~#6)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-09 |
| **ìˆ˜ì •ëœ íŒŒì¼** | `packages/worker/src/types/index.ts` â€” `SubtitleEntry` íƒ€ì… ì¶”ê°€ |
| **ì¶”ê°€ëœ íŒŒì¼** | `packages/worker/src/services/veo31-client.ts`, `packages/worker/src/services/video-processor.ts`, `packages/worker/src/services/subtitle-generator.ts` |
| **ë‚´ìš© ìš”ì•½** | **#3** trailer-engineì— `sora-client.ts` ì—†ìŒ â†’ ìŠ¤í‚µ. **#4** `veo31-client.ts` ë³µì‚¬ (Veo 3.1 Image-to-Video í´ë¼ì´ì–¸íŠ¸). **#5** `video-processor.ts` ë³µì‚¬ (FFmpeg ë³‘í•©Â·ìë§‰Â·ë”ë¯¸ ë¹„ë””ì˜¤). **#6** `subtitle-generator.ts` ë³µì‚¬ (WebVTT/SRT ìë§‰ ìƒì„±). video-processorÂ·subtitle-generatorìš©ìœ¼ë¡œ typesì— `SubtitleEntry` ì¶”ê°€. |
| **ë¹„ê³ ** | ê¸°ì¡´ `veo.service.ts`ëŠ” ìœ ì§€(ì§„ì…ì  ì—°ë™ ì‹œ êµì²´ ì˜ˆì •). workerì—ì„œ `npm install fluent-ffmpeg` ë° `npm install -D @types/fluent-ffmpeg` ì‹¤í–‰ í•„ìš”. |

---

### ì‘ì—… 4 â€” qc í´ë” ë³µì‚¬ (ì²´í¬ë¦¬ìŠ¤íŠ¸ 2ë²ˆ #7)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-09 |
| **ìˆ˜ì •ëœ íŒŒì¼** | ì—†ìŒ |
| **ì¶”ê°€ëœ íŒŒì¼** | `packages/worker/src/qc/` í•˜ìœ„ ì „ì²´ |
| **ì¶”ê°€ ê²½ë¡œ** | `qc/qcRunner.ts`, `qc/safetyGate.ts`, `qc/checkTypography.ts`, `qc/checkConsistency.ts`, `qc/scoreVideo.ts`, `qc/safetyKeywords.json`, `qc/thresholds.json`, `qc/typographyRules.json` |
| **ë‚´ìš© ìš”ì•½** | trailer-engine `src/qc/` í´ë”ë¥¼ workerë¡œ í†µì§¸ë¡œ ë³µì‚¬. Safety Gate â†’ Typography â†’ Consistency â†’ Video Scoring ìˆœì„œì˜ QC íŒŒì´í”„ë¼ì¸ ì½”ë“œ. |
| **ë¹„ê³ ** | qc ëª¨ë“ˆì€ `../shared/types`(QCReport, SceneScript, Anchor, TypographyPlan ë“±) ì°¸ì¡°. íƒ€ì… í†µí•©(shared ë³‘í•©) í›„ import ê²½ë¡œ ì •ë¦¬ ì˜ˆì •. **sora-client.ts**: trailer-engineÂ·lib-mvp ë‘˜ ë‹¤ í•´ë‹¹ íŒŒì¼ ì—†ìŒ(ë¬¸ì„œë§Œ ì–¸ê¸‰). |

---

### ì‘ì—… 5 â€” retry í´ë” ë³µì‚¬ (ì²´í¬ë¦¬ìŠ¤íŠ¸ 2ë²ˆ #8, #9)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-09 |
| **ìˆ˜ì •ëœ íŒŒì¼** | ì—†ìŒ |
| **ì¶”ê°€ëœ íŒŒì¼** | `packages/worker/src/retry/hierarchicalRetry.ts`, `retry/retryPolicy.ts`, `retry/sceneGenerator.ts` |
| **ë‚´ìš© ìš”ì•½** | trailer-engine `src/worker/`ì˜ hierarchicalRetry, retryPolicy, sceneGeneratorë¥¼ worker `src/retry/`ë¡œ ë³µì‚¬. ê³„ì¸µì  ì¬ì‹œë„(Scriptâ†’Keyframeâ†’Video), ì¥ë©´ë³„ ì¬ì‹œë„ ì •ì±…, ë³‘ë ¬/ìˆœì°¨ ì¥ë©´ ìƒì„± ë¡œì§. |
| **ë¹„ê³ ** | `../shared/types`, `../qc/thresholds.json` ì°¸ì¡°. qcëŠ” ì´ë¯¸ ë³µì‚¬ë¨ìœ¼ë¡œ thresholds.json ê²½ë¡œëŠ” ìœ íš¨. shared íƒ€ì…ì€ í†µí•© í›„ ì •ë¦¬. |

---

### ì‘ì—… 6 â€” Backend ë‚´ë¶€ ì½œë°± API ì¶”ê°€ (ì²´í¬ë¦¬ìŠ¤íŠ¸ 1Â·3.3 A ì—°ë™)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-09 |
| **ìˆ˜ì •ëœ íŒŒì¼** | `packages/backend/src/config/index.ts` â€” `internalApiSecret` ì¶”ê°€, `packages/backend/src/index.ts` â€” internal ë¼ìš°íŠ¸ ë“±ë¡, `packages/backend/prisma/schema.prisma` â€” `subtitleUrl` ì»¬ëŸ¼ ì¶”ê°€ |
| **ì¶”ê°€ëœ íŒŒì¼** | `packages/backend/src/routes/internal.routes.ts`, `packages/backend/prisma/migrations/20260209000000_add_subtitle_url/migration.sql` |
| **ë‚´ìš© ìš”ì•½** | Workerê°€ ì˜ìƒ ìƒì„± ì™„ë£Œ/ì‹¤íŒ¨ ì‹œ Backend DBë¥¼ ê°±ì‹ í•  ìˆ˜ ìˆë„ë¡ `POST /api/internal/video-callback` ì¶”ê°€. Body: bookId, status(READY\|FAILED), videoUrl?, subtitleUrl?, errorMessage?. Header: X-Internal-Secret. VideoRecordì— subtitleUrl ì»¬ëŸ¼ ì¶”ê°€(ë§ˆì´ê·¸ë ˆì´ì…˜). |
| **ë¹„ê³ ** | ì›ê²© DB ë§ˆì´ê·¸ë ˆì´ì…˜ì€ ì—°ê²° ì´ìŠˆë¡œ ë¯¸ì ìš©. ë¡œì»¬ì—ì„œ `npx prisma migrate deploy` ë˜ëŠ” `prisma db push` ì‹¤í–‰ í•„ìš”. |

---

### ì‘ì—… 7 â€” Worker ì§„ì…ì  ì½œë°± ì—°ë™ (ì²´í¬ë¦¬ìŠ¤íŠ¸ 1Â·3.3 A)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-09 |
| **ìˆ˜ì •ëœ íŒŒì¼** | `packages/worker/src/config/index.ts` â€” backendUrl, internalApiSecret ì¶”ê°€. `packages/worker/src/worker.ts` â€” ì™„ë£Œ/ì‹¤íŒ¨ ì‹œ notifyBackendVideoCallback í˜¸ì¶œ |
| **ì¶”ê°€ëœ íŒŒì¼** | `packages/worker/src/services/backend-callback.service.ts` |
| **ë‚´ìš© ìš”ì•½** | Worker Job ì²˜ë¦¬ í›„ ì„±ê³µ ì‹œ READY + videoUrl/subtitleUrl, ì‹¤íŒ¨ ì‹œ FAILED + errorMessageë¡œ Backend ì½œë°± í˜¸ì¶œ. ì§„ì…ì ì€ ë‹¹ë¶„ê°„ ê¸°ì¡´ videoGeneratorService.generateVideo() ìœ ì§€(íŒŒì´í”„ë¼ì¸ V2 ì „í™˜ ì‹œ GeminiProvider êµ¬í˜„ í›„ êµì²´ ì˜ˆì •). |
| **ë¹„ê³ ** | í™˜ê²½ë³€ìˆ˜: BACKEND_URL, INTERNAL_API_SECRET(ë˜ëŠ” JWT_SECRET). |

---

### ì‘ì—… 8 â€” ì €ì¥ì†Œ ì¶”ìƒí™” (ì²´í¬ë¦¬ìŠ¤íŠ¸ 3.3 D)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-09 |
| **ìˆ˜ì •ëœ íŒŒì¼** | ì—†ìŒ |
| **ì¶”ê°€ëœ íŒŒì¼** | `packages/worker/src/services/storage.provider.ts`, `storage-local.provider.ts`, `storage-s3.provider.ts`, `storage-provider.factory.ts` |
| **ë‚´ìš© ìš”ì•½** | StorageProvider ì¸í„°í˜ì´ìŠ¤(save/load/exists/getUrl) ì •ì˜. LocalStorageProvider(ë¡œì»¬ ë””ìŠ¤í¬), S3StorageProvider(ìŠ¤í…) êµ¬í˜„. getStorageProvider()ë¡œ config.storage.typeì— ë”°ë¼ local/s3 ë°˜í™˜. ê¸°ì¡´ storage.service.tsëŠ” ìœ ì§€. |
| **ë¹„ê³ ** | S3 ì‹¤ì œ ì—°ë™ì€ ì¶”í›„ êµ¬í˜„. STORAGE_TYPE=local ê¸°ë³¸. |

---

### ì‘ì—… 9 â€” .env.example ë³´ê°• + Config í†µí•© (ì²´í¬ë¦¬ìŠ¤íŠ¸ 3.3 B, 7ì¥)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-09 |
| **ìˆ˜ì •ëœ íŒŒì¼** | `library-did-main/.env.example`, `packages/worker/src/config/index.ts` â€” openaiApiKey ì¶”ê°€ |
| **ì¶”ê°€ëœ íŒŒì¼** | ì—†ìŒ |
| **ë‚´ìš© ìš”ì•½** | .env.exampleì— GEMINI_*, BACKEND_URL, INTERNAL_API_SECRET, OUTPUT_DIR, TEMP_DIR, SUBTITLE_LANGUAGE, LOG_LEVEL, DATABASE_URL, S3 ê´€ë ¨ ë“± ë°˜ì˜. Worker configì— OPENAI_API_KEY ì¶”ê°€. |
| **ë¹„ê³ ** | ì²´í¬ë¦¬ìŠ¤íŠ¸ 7ì¥ í™˜ê²½ë³€ìˆ˜ í‘œì™€ ë™ì¼í•˜ê²Œ ì •ë¦¬. |

---

### ì‘ì—… 10 â€” QC safetyGate ì—°ë™ (ì²´í¬ë¦¬ìŠ¤íŠ¸ 4ì ˆ Critical #4)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-09 |
| **ìˆ˜ì •ëœ íŒŒì¼** | `packages/worker/src/services/prompt.service.ts` â€” validateSafetyì—ì„œ isTextSafeForChildren ì‚¬ìš© |
| **ì¶”ê°€ëœ íŒŒì¼** | `packages/worker/src/qc/safetyCheck.ts` |
| **ë‚´ìš© ìš”ì•½** | ì½˜í…ì¸  ì•ˆì „ ê²€ì¦ì„ sharedì˜ isContentSafe ëŒ€ì‹  QC safetyGateì™€ ë™ì¼í•œ safetyKeywords.json ê¸°ë°˜ ê²€ì‚¬ë¡œ í†µì¼. safetyCheck.isTextSafeForChildren(title/summary)ë¡œ ê¸ˆì§€ ë‹¨ì–´Â·í…Œë§ˆ ê²€ì‚¬ í›„ VideoGeneratorServiceì—ì„œ ì‚¬ìš©. |
| **ë¹„ê³ ** | íŒŒì´í”„ë¼ì¸ V2 ì§„ì… ì‹œ ìŠ¤í¬ë¦½íŠ¸ ë‹¨ê³„ì—ì„œëŠ” ê¸°ì¡´ SafetyGate.validate(scripts, constraints) ìœ ì§€. |

---

### ì‘ì—… 11 â€” GeminiProvider êµ¬í˜„ + trailer-engine ì„œë¹„ìŠ¤ ê·¸ëŒ€ë¡œ ì‚¬ìš© (2.2ì ˆ ê¸°ì¤€)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-09 |
| **ìˆ˜ì •ëœ íŒŒì¼** | `packages/worker/src/services/gemini-client.ts`, `gemini-client-v2.ts`, `veo31-client.ts`, `nanova-banana-client.ts`, `subtitle-generator.ts`, `video-processor.ts`, `config/index.ts`(banana ì¶”ê°€) |
| **ì¶”ê°€ëœ íŒŒì¼** | `packages/worker/src/services/gemini-provider.adapter.ts` |
| **ë‚´ìš© ìš”ì•½** | **GeminiProvider:** PipelineOrchestratorV2ìš© GeminiProviderAdapter êµ¬í˜„. generateKeyframe = BANANA ì„¤ì • ì‹œ NanovaBananaClient(ì´ë¯¸ì§€ ìƒì„± í›„ Buffer ë°˜í™˜), ë¯¸ì„¤ì • ì‹œ í”Œë ˆì´ìŠ¤í™€ë” PNG. generateVideo = Veo31Client.generateVideoFromImageBuffer(keyframeBuffer, prompt, duration). **ì„œë¹„ìŠ¤ íŒŒì¼:** ì•„ì‚°ë„ì„œê´€_ê°œë°œ_Final.md 2.2ì ˆ â€œê·¸ëŒ€ë¡œ ì‚¬ìš©â€ ê¸°ì¤€ìœ¼ë¡œ, gemini-client, gemini-client-v2, veo31-client, nanova-banana-client, subtitle-generator, video-processorë¥¼ library-trailer-engine-main ë‚´ìš©ìœ¼ë¡œ êµì²´. veo31ì—ëŠ” Pipeline V2ìš© imageBytesBase64Â·generateVideoFromImageBuffer ìœ ì§€. nanova-bananaì—ëŠ” fetchImageAsBuffer ì¶”ê°€. |
| **ë¹„ê³ ** | .env.exampleì— BANANA_API_KEY, BANANA_MODEL_KEY ì¶”ê°€. |

---

### ì‘ì—… 12 â€” í…ŒìŠ¤íŠ¸ ê¸°ë™ ì˜¤ë¥˜ ìˆ˜ì • (ë¡œì»¬ npm run dev ë™ì‘ í™•ë³´)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-09 |
| **ìˆ˜ì •ëœ íŒŒì¼** | `library-did-main/package.json`, `packages/backend/package.json`, `packages/frontend/package.json`, `í…ŒìŠ¤íŠ¸_ì¤€ë¹„_ë°_ëª…ë ¹ì–´.md`(ê²½ë¡œÂ·Prisma ì•ˆë‚´ ìˆ˜ì •) |
| **ì¶”ê°€ëœ íŒŒì¼** | `í…ŒìŠ¤íŠ¸_ì¤€ë¹„_ë°_ëª…ë ¹ì–´.md` (í…ŒìŠ¤íŠ¸ ì¤€ë¹„Â·ëª…ë ¹ì–´Â·íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ì •ë¦¬) |
| **ë‚´ìš© ìš”ì•½** | **(1) Prisma:** ì „ì—­/ìµœì‹  Prisma 7 ì‚¬ìš© ì‹œ ìŠ¤í‚¤ë§ˆ ë¬¸ë²• ì˜¤ë¥˜ ë°œìƒ â†’ Backendì—ì„œ `npm run prisma:migrate:deploy`, `npm run prisma:generate` ë¡œ ë¡œì»¬ Prisma 5 ì‚¬ìš©í•˜ë„ë¡ ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€. **(2) Worker @smart-did/shared:** shared íŒ¨í‚¤ì§€ ë¯¸ë¹Œë“œ ì‹œ "Cannot find module '@smart-did/shared'" â†’ ë£¨íŠ¸ `dev:worker` ìŠ¤í¬ë¦½íŠ¸ë¥¼ `npm run build --workspace=@smart-did/shared && npm run dev --workspace=@smart-did/worker` ë¡œ ë³€ê²½í•´ ê¸°ë™ ì „ shared ë¹Œë“œ. **(3) Backend Fastify:** Fastify 5 + @fastify/cors 8Â·@fastify/jwt 10 ì¡°í•©ì—ì„œ í”ŒëŸ¬ê·¸ì¸ ë²„ì „ ë¶ˆì¼ì¹˜ â†’ Backendë¥¼ Fastify ^4.28.0, @fastify/jwt ^8.0.0 ìœ¼ë¡œ ë§ì¶¤. **(4) í…ŒìŠ¤íŠ¸ ë¬¸ì„œ:** DB ë§ˆì´ê·¸ë ˆì´ì…˜ ê²½ë¡œ(`packages/backend` ê¸°ì¤€), npx prisma ëŒ€ì‹  npm run ì‚¬ìš© ì•ˆë‚´ ë°˜ì˜. **(5) Frontend:** postcss.config.js ê´€ë ¨ MODULE_TYPELESS_PACKAGE_JSON ê²½ê³  ì œê±°ë¥¼ ìœ„í•´ `packages/frontend/package.json`ì— `"type": "module"` ì¶”ê°€. |
| **ë¹„ê³ ** | Redis ì‹¤í–‰, .env í•„ìˆ˜ê°’(GEMINI_API_KEY ë“±), `cd packages/backend` í›„ Prisma ë§ˆì´ê·¸ë ˆì´ì…˜Â·generate í•„ìš”. ìƒì„¸ëŠ” `í…ŒìŠ¤íŠ¸_ì¤€ë¹„_ë°_ëª…ë ¹ì–´.md` ì°¸ê³ . |

---

### ì‘ì—… 13 â€” Worker ì§„ì…ì  Pipeline V2 ì „í™˜ (1ë‹¨ê³„)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-09 |
| **ìˆ˜ì •ëœ íŒŒì¼** | `packages/worker/src/worker.ts` |
| **ì¶”ê°€ëœ íŒŒì¼** | ì—†ìŒ |
| **ë‚´ìš© ìš”ì•½** | **ì§„ì…ì  ì „í™˜:** `videoGeneratorService.generateVideo()` í˜¸ì¶œ ì œê±°. `PipelineOrchestratorV2` + `GeminiProviderAdapter` ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•´ Job ì²˜ë¦¬ ì‹œ `pipelineOrchestrator.execute(request)` í˜¸ì¶œ. **ë§¤í•‘:** `VideoJobData`(bookId, title, author, summary) â†’ `VideoGenerationRequest`(title, author, language: 'ko') ë³€í™˜ í•¨ìˆ˜ `toVideoGenerationRequest()` ì¶”ê°€. **ê²°ê³¼ ì²˜ë¦¬:** ë°˜í™˜ê°’ `status === 'completed'`ì´ë©´ `notifyBackendVideoCallback(READY, videoUrl, subtitleUrl)`, ê·¸ ì™¸ë©´ `notifyBackendVideoCallback(FAILED, errorMessage)`. ê¸°ì¡´ Backend ì½œë°± í˜•ì‹Â·ì—ëŸ¬ ì‹œ ì¬throw ë™ì‘ ìœ ì§€. |
| **ë¹„ê³ ** | Pipeline V2 ë‚´ë¶€ Step 7(Assembly)ì€ ì•„ì§ placeholder. ì‹¤ì œ ì˜ìƒ íŒŒì¼ ê²½ë¡œÂ·FFmpeg ì—°ë™ì€ 2ë‹¨ê³„(FFmpeg ì‹¤ì œ ì—°ë™)ì—ì„œ ì§„í–‰. |

---

### ì‘ì—… 14 â€” í”„ë¡ íŠ¸ì—”ë“œ: DID ì˜ìƒ ì¬ìƒÂ·í”„ë¡œí† íƒ€ì…(/pip) ë° ì˜ìƒ URL ìˆ˜ì •

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-11 |
| **ìˆ˜ì •ëœ íŒŒì¼** | `packages/frontend/src/pages/did/DidVideoPlayer.tsx` *(êµ¬ë²„ì „/ì´í›„ ì‚­ì œë¨)*, `packages/frontend/src/App.tsx` |
| **ì¶”ê°€ëœ íŒŒì¼** | `packages/frontend/src/vite-env.d.ts` |
| **ë‚´ìš© ìš”ì•½** | **(1) ì˜ìƒ URL ìˆ˜ì •:** ë°±ì—”ë“œëŠ” `GET /api/videos/:filename`ìœ¼ë¡œ ì„œë¹™í•˜ëŠ”ë°, í”„ë¡ íŠ¸ê°€ ìƒëŒ€ ê²½ë¡œ videoUrlì„ ì¡°í•©í•  ë•Œ `/api`ë¥¼ ì œê±°í•´ `.../videos/xxx.mp4`ë¡œ ìš”ì²­í•˜ë˜ ë¬¸ì œ ìˆ˜ì •. API baseë¥¼ `/api` í¬í•¨í•œ ê°’ìœ¼ë¡œ ë‘ì–´ `.../api/videos/xxx.mp4`ë¡œ ìš”ì²­í•˜ë„ë¡ ë³€ê²½. **(2) /pip ë¼ìš°íŠ¸:** í”„ë¡œí† íƒ€ì…ìš©ìœ¼ë¡œ `/pip` â†’ `/did/video/ISBN-001` ë¦¬ë‹¤ì´ë ‰íŠ¸, `/pip/:bookId` â†’ DidVideoPlayer í‘œì‹œ ì¶”ê°€. **(3) í”„ë¡œí† íƒ€ì… fallback:** API ì˜ìƒ ë¡œë“œ ì‹¤íŒ¨ ì‹œ onErrorì—ì„œ ìƒ˜í”Œ ì˜ìƒ URLë¡œ ì „í™˜; ì—ëŸ¬/ìƒì„± ì¤‘ ìƒíƒœì—ì„œ videoUrlì´ ì—†ìœ¼ë©´ 3ì´ˆ í›„ ë™ì¼ ìƒ˜í”Œ ì¬ìƒ. `VITE_PROTOTYPE_FALLBACK_VIDEO`ë¡œ URL ì˜¤ë²„ë¼ì´ë“œ ê°€ëŠ¥. **(4) íƒ€ì…:** import.meta.env íƒ€ì… ì—ëŸ¬ ë°©ì§€ë¥¼ ìœ„í•´ vite-env.d.ts ì¶”ê°€, DidVideoPlayerì—ì„œ envë¥¼ ë³€ìˆ˜ë¡œ ì¶”ì¶œí•´ ì‚¬ìš©. |
| **ë¹„ê³ ** | ì‹œë“œ ë„ì„œ ISBN-001ì— READY ì˜ìƒì´ ìˆìœ¼ë©´ /pipì—ì„œ ì¬ìƒ. ì—†ê±°ë‚˜ 404ë©´ fallback ìƒ˜í”Œ ì¬ìƒ. |

---

### ì‘ì—… 15 â€” ë°±ì—”ë“œ ê¸°ë™ ì˜¤ë¥˜ ìˆ˜ì • (tsx watchÂ·Fastify 5 í”ŒëŸ¬ê·¸ì¸)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-11 |
| **ìˆ˜ì •ëœ íŒŒì¼** | `packages/backend/package.json` |
| **ì¶”ê°€ëœ íŒŒì¼** | ì—†ìŒ |
| **ë‚´ìš© ìš”ì•½** | **(1) tsx watch ì œê±°:** dev ìŠ¤í¬ë¦½íŠ¸ë¥¼ `tsx watch src/index.ts` â†’ `tsx src/index.ts`ë¡œ ë³€ê²½. ì¼ë¶€ í™˜ê²½ì—ì„œ `tsx watch`ê°€ IPC íŒŒì´í”„ ìƒì„± ì‹œ EPERM(operation not permitted) ë°œìƒí•˜ë¯€ë¡œ watch ì—†ì´ ì‹¤í–‰í•˜ë„ë¡ ìˆ˜ì •. **(2) Fastify 5 í”ŒëŸ¬ê·¸ì¸ í˜¸í™˜:** ë°±ì—”ë“œëŠ” Fastify 5.7.4 ì‚¬ìš© ì¤‘ì¸ë°, ê¸°ì¡´ @fastify/* í”ŒëŸ¬ê·¸ì¸ì´ Fastify 4ìš©ì´ë¼ "expected '4.x' fastify version" ì˜¤ë¥˜ ë°œìƒ. ë‹¤ìŒ ë²„ì „ìœ¼ë¡œ ì—…ê·¸ë ˆì´ë“œ: @fastify/cors ^8.5.0 â†’ ^10.0.0, @fastify/helmet ^11.1.1 â†’ ^12.0.0, @fastify/swagger ^8.13.0 â†’ ^9.0.0, @fastify/swagger-ui ^2.1.0 â†’ ^5.0.0. |
| **ë¹„ê³ ** | ì½”ë“œ ìˆ˜ì • í›„ ìë™ ì¬ì‹¤í–‰ì´ í•„ìš”í•˜ë©´ nodemon ë“±ìœ¼ë¡œ dev ìŠ¤í¬ë¦½íŠ¸ êµì²´ ê°€ëŠ¥. |

---

### ì‘ì—… 16 â€” Worker .env ë¡œë“œ ê²½ë¡œ ìˆ˜ì • ë° ê¸°ë™ ì‹œ í‚¤ ë¡œë“œ ë¡œê·¸

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-11 |
| **ìˆ˜ì •ëœ íŒŒì¼** | `packages/worker/src/config/index.ts`, `packages/worker/src/index.ts` |
| **ì¶”ê°€ëœ íŒŒì¼** | ì—†ìŒ |
| **ë‚´ìš© ìš”ì•½** | **(1) .env ê²½ë¡œ ìˆ˜ì •:** configì˜ dotenvê°€ `path.resolve(__dirname, '../../../.env')`ë¥¼ ì‚¬ìš©í•´ `packages/.env`ë¥¼ ì°¸ì¡°í•˜ê³  ìˆì–´, ì‹¤ì œ .envê°€ ìˆëŠ” `library-did-main/.env`ë¥¼ ì½ì§€ ëª»í•¨. `library-did-main/.env`ë¥¼ ì°¾ë„ë¡ ì—¬ëŸ¬ ê²½ë¡œ(../../../../.env, ../../../.env, process.cwd() ê¸°ì¤€ .env ë“±)ë¥¼ ìˆœì„œëŒ€ë¡œ ì‹œë„í•˜ë„ë¡ ë³€ê²½. **(2) ê¸°ë™ ì‹œ í‚¤ ë¡œë“œ ë¡œê·¸:** Worker ê¸°ë™ ì‹œ GEMINI_API_KEY, OPENAI_API_KEY(Sora), VEO_API_KEYê°€ set/NOT SETì¸ì§€ë§Œ ë¡œê·¸ë¡œ ì¶œë ¥(í‚¤ ê°’ì€ ë…¸ì¶œí•˜ì§€ ì•ŠìŒ). í‚¤ ë¯¸ì„¤ì • ì‹œ 403Â·No video provider ì›ì¸ í™•ì¸ ìš©ì´. |
| **ë¹„ê³ ** | .envëŠ” `library-did-main/.env` í•œ ê³³ì— ë‘ê³ , Worker ì¬ì‹œì‘ í›„ ë¡œê·¸ì—ì„œ "set" í™•ì¸. |

---

### ì‘ì—… 17 â€” MVP: Mock ë„ì„œë¡œ ì˜ìƒ ìƒì„± (ALPAS Mock ì „í™˜)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-11 |
| **ìˆ˜ì •ëœ íŒŒì¼** | `packages/backend/src/services/alpas.service.ts`, `packages/frontend/src/App.tsx` |
| **ì¶”ê°€ëœ íŒŒì¼** | ì—†ìŒ |
| **ë‚´ìš© ìš”ì•½** | **(1) Backend:** `alpas.service.ts`ë¥¼ ì‹¤ì œ ALPAS API ëŒ€ì‹  **Mock**(`alpas.service.mock.ts`)ì„ ì‚¬ìš©í•˜ë„ë¡ ë³€ê²½. DIDÂ·ë„ì„œ ìƒì„¸Â·ê²€ìƒ‰Â·ì˜ìƒ ìš”ì²­ì´ ëª¨ë‘ **MOCK_BOOKS**(BK001~BK035, 35ê¶Œ) ê¸°ì¤€ìœ¼ë¡œ ë™ì‘. ì‹¤ì œ API ì‚¬ìš© ì‹œ `alpas.service.ts`ì—ì„œ `from './alpas-real.service'` ë¡œ exportë§Œ ë°”ê¾¸ë©´ ë¨. **(2) Frontend:** í”„ë¡œí† íƒ€ì… `/pip` ê¸°ë³¸ ì´ë™ì„ ISBN-001 â†’ **BK001**(Mock ë„ì„œ ID)ë¡œ ë³€ê²½. |
| **ë¹„ê³ ** | Mock ë„ì„œ 35ê¶Œìœ¼ë¡œ DID í…Œë§ˆë³„ ëª©ë¡Â·ì˜ìƒ ìƒì„± ìš”ì²­Â·Worker íŒŒì´í”„ë¼ì¸ E2E ê²€ì¦ ê°€ëŠ¥. |

---

### ì‘ì—… 18 â€” Sora API ì—”ë“œí¬ì¸íŠ¸ ìˆ˜ì • ë° ì½œë°± 401 ì•ˆë‚´

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-11 |
| **ìˆ˜ì •ëœ íŒŒì¼** | `packages/worker/src/services/sora-client.ts`, `packages/worker/src/services/veo.service.ts`, `.env.example`, `ê°œë°œ docs/ê°œë°œ_ê¸°ë¡.md` |
| **ì¶”ê°€ëœ íŒŒì¼** | ì—†ìŒ |
| **ë‚´ìš© ìš”ì•½** | **(1) Sora 405 ìˆ˜ì •:** Workerê°€ ì‚¬ìš©í•˜ë˜ `POST /v1/videos/generations`ëŠ” OpenAI ê³µì‹ ìŠ¤í™ì´ ì•„ë‹˜. ê³µì‹ì€ `POST /v1/videos`(ìƒì„±) â†’ `GET /v1/videos/{id}`(í´ë§) â†’ `GET /v1/videos/{id}/content`(ë‹¤ìš´ë¡œë“œ). sora-client.tsë¥¼ ìœ„ ìŠ¤í™ì— ë§ê²Œ ìˆ˜ì •(model: sora-2, seconds, size ë“±). **(2) VeoService í˜¸í™˜:** Soraê°€ ì´ì œ URLì´ ì•„ë‹Œ bufferë§Œ ë°˜í™˜í•˜ë¯€ë¡œ, veo.serviceì˜ generateWithSoraì—ì„œ videoBufferì¼ ë•Œ ì„ì‹œ íŒŒì¼ë¡œ ì €ì¥ í›„ file URL ë°˜í™˜í•˜ë„ë¡ ì²˜ë¦¬. **(3) ì½œë°± 401:** Workerâ†’Backend ì½œë°± ì‹œ 401ì´ ë‚˜ì˜¤ë©´ Backendì™€ Workerì˜ `INTERNAL_API_SECRET`(ë˜ëŠ” JWT_SECRET fallback) ê°’ì´ **ë™ì¼í•œì§€** í™•ì¸. .env í•œ ê³³(library-did-main/.env)ì„ ë‘ ì•±ì´ ê³µí†µìœ¼ë¡œ ì“°ë©´ ì¼ì¹˜í•¨. |
| **ë¹„ê³ ** | Sora APIëŠ” ì¡°ì§ ê²€ì¦Â·ì´ˆëŒ€ ê¸°ë°˜ ì ‘ê·¼ì¼ ìˆ˜ ìˆìŒ. 405 í•´ê²° í›„ì—ë„ 403/402 ë“±ì´ ë‚˜ì˜¤ë©´ OpenAI ëŒ€ì‹œë³´ë“œì—ì„œ ë¹„ë””ì˜¤ API ê¶Œí•œ í™•ì¸. |

---

### ì‘ì—… 19 â€” 3ì¥ë©´ FFmpeg ë³‘í•© ì ìš© (trailer-engine assemble ì—°ë™)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-11 |
| **ìˆ˜ì •ëœ íŒŒì¼** | `packages/worker/src/pipeline/assemble.ts`, `packages/worker/src/pipeline/orchestrator.ts` |
| **ì¶”ê°€ëœ íŒŒì¼** | ì—†ìŒ |
| **ë‚´ìš© ìš”ì•½** | **(1) assemble.ts:** trailer-engineê³¼ ë™ì¼í•œ VideoAssemblerì— **concatAndSubtitles(scenes, subtitlePath, outputPath)** ì¶”ê°€. concat(FFmpeg) â†’ ìë§‰ burnë§Œ ìˆ˜í–‰(íƒ€ì´í‹€ ì¹´ë“œ ì œì™¸). concat ë¦¬ìŠ¤íŠ¸ëŠ” **íŒŒì¼ëª…ë§Œ** ì‚¬ìš©í•´ Windows/ê²½ë¡œ ì´ìŠˆ ë°©ì§€. addSubtitlesì—ì„œ ê²½ë¡œ **ë°±ìŠ¬ë˜ì‹œ â†’ ìŠ¬ë˜ì‹œ** ì •ê·œí™”. **(2) orchestrator Step 7:** ì„±ê³µí•œ ì¥ë©´ì„ sceneNumber ìˆœìœ¼ë¡œ ì •ë ¬ í›„, tempDirì— scene-1.mp4Â·scene-2.mp4Â·scene-3.mp4ì™€ VTT íŒŒì¼ ê¸°ë¡ â†’ VideoAssembler.concatAndSubtitles í˜¸ì¶œ â†’ ë³‘í•©ëœ íŒŒì¼ì„ storageì— ì €ì¥ í›„ videoUrl ë°˜í™˜. FFmpeg ë¯¸ì„¤ì¹˜ ë˜ëŠ” ë³‘í•© ì‹¤íŒ¨ ì‹œ **ì²« ë²ˆì§¸ ì¥ë©´ë§Œ** ì €ì¥í•˜ëŠ” fallback ìœ ì§€. **(3) ì •ë¦¬:** temp ë””ë ‰í„°ë¦¬ ì‚­ì œ, ë¶ˆí•„ìš”í•œ import(TypographyPlan) ì œê±°. |
| **ë¹„ê³ ** | FFmpeg ì„¤ì¹˜ í•„ìš”. ìë§‰ burn ì‹œ Noto Sans KR ë“± ì§€ì • í°íŠ¸ê°€ ì—†ìœ¼ë©´ addSubtitles ë‹¨ê³„ì—ì„œ ì‹¤íŒ¨í•  ìˆ˜ ìˆìŒ(ì‹¤íŒ¨ ì‹œ fallbackìœ¼ë¡œ ì²« ì¥ë©´ë§Œ ì €ì¥). |

---

### ì‘ì—… 20 â€” Admin í˜ì´ì§€ DID ë™ì¼ ë·°í¬íŠ¸(480px) ë° DID ë ˆì´ì•„ì›ƒ í”ë“¤ë¦¼ ë°©ì§€

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì™„ë£Œ ì¼ì‹œ** | 2026-02-13 |
| **ìˆ˜ì •ëœ íŒŒì¼** | `packages/frontend/src/App.tsx`, `packages/frontend/src/pages/admin/Login.tsx`, `packages/frontend/src/pages/admin/Dashboard.tsx`, `packages/frontend/src/pages/admin/VideoManagement.tsx`, `packages/frontend/src/pages/did/DidV2BookDetail.tsx`, `packages/frontend/src/pages/did/DidV2Layout.tsx`, `packages/frontend/src/index.css` |
| **ì¶”ê°€ëœ íŒŒì¼** | `packages/frontend/src/pages/admin/AdminLayout.tsx`, `packages/frontend/src/pages/admin/AdminRecommendBook.tsx` |
| **ë‚´ìš© ìš”ì•½** | **(1) Admin ë ˆì´ì•„ì›ƒ:** DIDì™€ ë™ì¼í•œ 480px ë·°í¬íŠ¸ë¡œ `AdminLayout` ì¶”ê°€. ìƒë‹¨ ê²€ì • í—¤ë” "BOOK MATE ê´€ë¦¬ì", ëŒ€ì‹œë³´ë“œ ì™¸ í˜ì´ì§€ì—ì„œ "â† ëŒ€ì‹œë³´ë“œ" ë²„íŠ¼ í‘œì‹œ. **(2) Admin ëŒ€ì‹œë³´ë“œ:** API ì‚¬ìš© í˜„í™©(ì´ ìƒì„± ìˆ˜, ì‚¬ìš© ë¹„ìš©, ì”ì—¬ ì˜ˆì‚°, ìƒì„± ê°€ëŠ¥ ê°œìˆ˜), ì‚¬ì„œ ì¶”ì²œ ë„ì„œ ì¶”ê°€(ì±… ì œëª© + "+ ì¶”ì²œë„ì„œ ë“±ë¡" ë²„íŠ¼ â†’ /admin/recommend), ì¸ê¸° ì‚¬ìš© ì±…, ì´ìš©ì ìƒì„± ë¡œê·¸(ê²€ìƒ‰Â·í…Œì´ë¸” í—¤ë”Â·ë¹ˆ ìƒíƒœ), í•˜ë‹¨ ë¹¨ê°„ ì•ˆë‚´ ë¬¸êµ¬. **(3) ì¶”ì²œë„ì„œ ë“±ë¡:** `/admin/recommend` í˜ì´ì§€ ì¶”ê°€. ì œëª©, ì—°ë ¹ëŒ€, ì§ˆë¬¸(ìë§‰), íƒœê·¸, ì»¤ë²„(ì´ëª¨ì§€), ì¡´ ìƒìƒ, ì±…ì¥/ì¤„, "ğŸ“’ ë“±ë¡í•˜ê¸° (ë©”ì¸ì— ë…¸ì¶œ)" ë²„íŠ¼. **(4) ì˜ìƒ ê´€ë¦¬:** AdminLayout ì ìš©, 480pxì— ë§ì¶° ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ í˜•íƒœë¡œ í‘œì‹œ. **(5) ë¡œê·¸ì¸:** 480px ì¤‘ì•™ ë˜í¼ë¡œ DIDì™€ ë™ì¼ ë„ˆë¹„. **(6) ì±… ë¯¸ë¦¬ë³´ê¸°:** "ì´ ì±…ì€ ì—¬ê¸° ìˆì–´ìš”! {ì œëª©}" ë¬¸êµ¬ë¥¼ ì±… ë¯¸ë¦¬ë³´ê¸°(DidV2BookDetail)ì—ì„œ ì œê±° â†’ ìœ„ì¹˜ ì•ˆë‚´ í˜ì´ì§€(DidV2Location)ì—ì„œë§Œ ë…¸ì¶œ. **(7) /did í˜ì´ì§€ ì´ë™ ì‹œ ë ˆì´ì•„ì›ƒ í”ë“¤ë¦¼ ë°©ì§€:** DidV2Layoutì˜ mainì— `scrollbar-gutter: stable` ì ìš©, ë ˆì´ì•„ì›ƒ ë£¨íŠ¸ì— `overflow-x-hidden`Â·`max-w-[480px]`. index.cssì— html `scrollbar-gutter: stable`, body `overflow-x: hidden` ì¶”ê°€. |
| **ë¹„ê³ ** | *(ë‹¹ì‹œ ê¸°ì¤€)* ê´€ë¦¬ì ê¸°ë³¸ ê³„ì •/UIëŠ” ì´í›„ ë³€ê²½ë¨. ì¶”ì²œë„ì„œ ë“±ë¡ ì œì¶œì€ ë°±ì—”ë“œ API ì—°ë™ í›„ ì—°ë™ ì˜ˆì •. |

---

</details>

## ì•ìœ¼ë¡œ í•  ê²ƒ

- **DB(ìš´ì˜ í™˜ê²½)**: PostgreSQL ì „í™˜ ì‹œ `DATABASE_URL` ì„¤ì • + ë§ˆì´ê·¸ë ˆì´ì…˜/ì¸ë±ìŠ¤ ì ê²€
- **S3 ìŠ¤í† ë¦¬ì§€**: S3StorageProvider ì‹¤ì œ êµ¬í˜„(presigned URL í¬í•¨)
- **ìƒíƒœ ë¦¬ì»¨ì‹¤ë¦¬ì—ì´ì…˜**: í/DB/ìŠ¤í† ë¦¬ì§€ ìƒíƒœ ë¶ˆì¼ì¹˜ ì‹œ ì¬ë™ê¸°í™” ë£¨í‹´(ìš´ì˜ ì•ˆì •ì„±)
- **ALPAS ì‘ë‹µ ë³€ë™ ëŒ€ì‘**: ìƒˆ í•„ë“œ/ì¼€ì´ìŠ¤(ëŒ€ì†Œë¬¸ì, í‚¤ëª… ë³€í™”) ë“¤ì–´ì™€ë„ ë§¤í•‘ì´ ì•ˆì „í•˜ê²Œ ë™ì‘í•˜ëŠ”ì§€ ì§€ì† ì ê²€
